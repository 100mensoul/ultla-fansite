<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã¤ãã‚‹ãƒšãƒ¼ã‚¸ | ULTLAãƒ©ãƒœ</title>
  <link rel="stylesheet" href="../../style.css">
  <style>
    /* æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ã¯ãã®ã¾ã¾ä¿æŒ */
    
    .detail-header {
      background: linear-gradient(135deg, var(--ultla-blue) 0%, #007BB8 100%);
      color: white;
      padding: var(--spacing-2xl) 0;
      margin-bottom: var(--spacing-2xl);
      position: relative;
      overflow: hidden;
    }
    
    .detail-header::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 30% 40%, rgba(255,255,255,0.15) 0%, transparent 50%),
        radial-gradient(circle at 70% 80%, rgba(0,163,217,0.3) 0%, transparent 40%);
      z-index: 1;
    }
    
    .detail-header .container {
      position: relative;
      z-index: 2;
    }
    
    .detail-title {
      font-size: clamp(2rem, 5vw, 3rem);
      margin-bottom: var(--spacing-sm);
      font-weight: 500;
    }
    
    .detail-subtitle {
      font-size: 1.2rem;
      opacity: 0.9;
      margin-bottom: var(--spacing-lg);
    }
    
    .detail-meta {
      display: flex;
      gap: var(--spacing-lg);
      flex-wrap: wrap;
      font-size: 0.95rem;
    }
    
    .meta-item {
      background: rgba(255,255,255,0.2);
      padding: var(--spacing-xs) var(--spacing-sm);
      border-radius: var(--radius-md);
      backdrop-filter: blur(10px);
    }

    /* èªè¨¼çŠ¶æ…‹è¡¨ç¤º */
    .auth-section {
      background: var(--bg-card);
      padding: var(--spacing-lg);
      border-radius: var(--radius-lg);
      margin-bottom: var(--spacing-xl);
      box-shadow: var(--shadow-md);
      text-align: center;
    }

    .login-status {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-md);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .logout-btn {
      background: var(--ultla-red);
      color: white;
      border: none;
      padding: var(--spacing-xs) var(--spacing-sm);
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: 0.9rem;
      transition: all var(--transition-fast);
    }

    .logout-btn:hover {
      background: #c92a2a;
    }

    .login-prompt {
      color: var(--text-secondary);
    }

    .login-link {
      color: var(--ultla-blue);
      text-decoration: none;
      font-weight: 500;
    }

    .login-link:hover {
      color: var(--ultla-green);
    }

    /* è­°äº‹éŒ²æŠ•ç¨¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .upload-section {
      background: var(--bg-card);
      padding: var(--spacing-xl);
      border-radius: var(--radius-lg);
      margin-bottom: var(--spacing-xl);
      box-shadow: var(--shadow-md);
      border: 2px dashed var(--border-light);
      transition: all var(--transition-normal);
      display: none; /* åˆæœŸçŠ¶æ…‹ã§ã¯éè¡¨ç¤º */
    }
    
    .upload-section.show {
      display: block;
    }
    
    .upload-section.dragover {
      border-color: var(--ultla-blue);
      background: rgba(0,163,217,0.05);
    }
    
    .upload-form {
      max-width: 600px;
      margin: 0 auto;
    }
    
    .form-group {
      margin-bottom: var(--spacing-md);
    }
    
    .form-group label {
      display: block;
      margin-bottom: var(--spacing-xs);
      font-weight: 500;
      color: var(--text-primary);
    }
    
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: var(--spacing-sm);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      font-size: 1rem;
      box-sizing: border-box;
      transition: border-color var(--transition-fast);
    }
    
    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--ultla-blue);
      box-shadow: 0 0 0 3px rgba(0,163,217,0.1);
    }
    
    .file-drop-zone {
      border: 2px dashed var(--border-light);
      border-radius: var(--radius-lg);
      padding: var(--spacing-2xl);
      text-align: center;
      transition: all var(--transition-normal);
      cursor: pointer;
      margin-bottom: var(--spacing-md);
    }
    
    .file-drop-zone.dragover {
      border-color: var(--ultla-blue);
      background: rgba(0,163,217,0.05);
    }
    
    .file-info {
      background: var(--bg-light);
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      margin-top: var(--spacing-sm);
      display: none;
    }
    
    .submit-btn {
      background: linear-gradient(135deg, var(--ultla-blue), var(--ultla-green));
      color: white;
      padding: var(--spacing-md) var(--spacing-xl);
      border: none;
      border-radius: var(--radius-md);
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-normal);
      box-shadow: var(--shadow-md);
      width: 100%;
    }
    
    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }
    
    .submit-btn:disabled {
      background: var(--text-muted);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ - æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¨çµ±åˆ */
    .search-filter-section {
      background: var(--bg-card);
      padding: var(--spacing-xl);
      border-radius: var(--radius-lg);
      margin-bottom: var(--spacing-xl);
      box-shadow: var(--shadow-md);
    }
    
    .search-container {
      display: flex;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
      flex-wrap: wrap;
    }
    
    .search-input {
      flex: 1;
      min-width: 250px;
      padding: var(--spacing-md);
      border: 2px solid var(--border-light);
      border-radius: var(--radius-md);
      font-size: 1rem;
      transition: border-color var(--transition-normal);
    }
    
    .search-input:focus {
      outline: none;
      border-color: var(--ultla-blue);
    }
    
    .search-btn {
      padding: var(--spacing-md) var(--spacing-lg);
      background: var(--ultla-blue);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 500;
      cursor: pointer;
      transition: background var(--transition-normal);
    }
    
    .search-btn:hover {
      background: var(--ultla-green);
    }
    
    /* ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ */
    .tag-filters {
      display: flex;
      gap: var(--spacing-xs);
      flex-wrap: wrap;
      margin-bottom: var(--spacing-md);
    }
    
    .tag-filter {
      padding: var(--spacing-xs) var(--spacing-sm);
      background: var(--bg-light);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-full);
      font-size: 0.85rem;
      cursor: pointer;
      transition: all var(--transition-fast);
      user-select: none;
    }
    
    .tag-filter:hover {
      background: rgba(0,163,217,0.1);
      border-color: var(--ultla-blue);
    }
    
    .tag-filter.active {
      background: var(--ultla-blue);
      color: white;
      border-color: var(--ultla-blue);
    }
    
    .tag-filter.category {
      background: var(--ultla-green);
      color: white;
      border-color: var(--ultla-green);
    }
    
    .tag-filter.area {
      background: var(--ultla-blue);
      color: white;
      border-color: var(--ultla-blue);
    }
    
    .tag-filter.theme {
      background: var(--ultla-red);
      color: white;
      border-color: var(--ultla-red);
    }
    
    /* è­°äº‹éŒ²ã‚«ãƒ¼ãƒ‰ - æ—¢å­˜ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ä¿æŒ */
    .minutes-grid {
      display: grid;
      gap: var(--spacing-lg);
    }
    
    .minutes-card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border-light);
      transition: all var(--transition-normal);
      position: relative;
    }
    
    .minutes-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }
    
    .minutes-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: var(--spacing-md);
    }
    
    .minutes-date {
      font-size: 0.9rem;
      color: var(--text-muted);
      background: var(--bg-light);
      padding: var(--spacing-xs) var(--spacing-sm);
      border-radius: var(--radius-sm);
    }
    
    .minutes-title {
      font-size: 1.1rem;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: var(--spacing-xs);
    }
    
    .minutes-participants {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-bottom: var(--spacing-md);
    }
    
    .minutes-content {
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: var(--spacing-md);
    }
    
    .minutes-tags {
      display: flex;
      gap: var(--spacing-xs);
      flex-wrap: wrap;
      margin-bottom: var(--spacing-md);
    }
    
    .minutes-tag {
      font-size: 0.75rem;
      padding: 2px var(--spacing-xs);
      border-radius: var(--radius-sm);
      font-weight: 500;
    }
    
    .tag-area { background: rgba(0,163,217,0.1); color: var(--ultla-blue); }
    .tag-category { background: rgba(0,184,148,0.1); color: var(--ultla-green); }
    .tag-theme { background: rgba(255,107,107,0.1); color: var(--ultla-red); }
    .tag-program { background: rgba(108,99,255,0.1); color: #6C63FF; }
    
    .minutes-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .view-detail-btn {
      color: var(--ultla-blue);
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      transition: color var(--transition-fast);
    }
    
    .view-detail-btn:hover {
      color: var(--ultla-green);
    }
    
    .view-detail-btn::after {
      content: "â†’";
      transition: transform var(--transition-fast);
    }
    
    .view-detail-btn:hover::after {
      transform: translateX(2px);
    }

    .edit-btn, .delete-btn {
      padding: var(--spacing-xs) var(--spacing-sm);
      border: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: 0.8rem;
      margin-left: var(--spacing-xs);
      transition: all var(--transition-fast);
    }

    .edit-btn {
      background: var(--ultla-blue);
      color: white;
    }

    .edit-btn:hover {
      background: var(--ultla-green);
    }

    .delete-btn {
      background: var(--ultla-red);
      color: white;
    }

    .delete-btn:hover {
      background: #c92a2a;
    }
    
    /* çµæœè¡¨ç¤º */
    .results-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-lg);
      padding: var(--spacing-md);
      background: var(--bg-light);
      border-radius: var(--radius-md);
    }
    
    .results-count {
      font-size: 0.9rem;
      color: var(--text-secondary);
    }
    
    .sort-select {
      padding: var(--spacing-xs) var(--spacing-sm);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      font-size: 0.85rem;
      background: white;
    }

    /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ»ã‚¨ãƒ©ãƒ¼è¡¨ç¤º */
    .loading-message {
      text-align: center;
      padding: var(--spacing-2xl);
      color: var(--text-muted);
    }

    .error-message {
      background: #fee;
      border: 1px solid #fcc;
      color: #a00;
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      margin-bottom: var(--spacing-md);
    }

    .success-message {
      background: #efe;
      border: 1px solid #cfc;
      color: #090;
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      margin-bottom: var(--spacing-md);
    }
    
    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
    @media (max-width: 768px) {
      .login-status {
        flex-direction: column;
        gap: var(--spacing-sm);
      }
      
      .search-container {
        flex-direction: column;
      }
      
      .search-input {
        min-width: unset;
      }
      
      .minutes-header {
        flex-direction: column;
        gap: var(--spacing-sm);
      }
      
      .results-info {
        flex-direction: column;
        gap: var(--spacing-sm);
        text-align: center;
      }
      
      .tag-filters {
        justify-content: center;
      }

      .minutes-actions {
        flex-direction: column;
        gap: var(--spacing-sm);
        align-items: stretch;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>ULTLAãƒ©ãƒœ</h1>
      <nav>
        <a href="../../1_news/index.html">ãƒ‹ãƒ¥ãƒ¼ã‚¹</a>
        <a href="../../2_about/index.html">ULTLAã¨ã¯</a>
        <a href="../../3_people/index.html">ULTLAäºº</a>
        <a href="../../4_map/index.html">ãƒãƒƒãƒ—</a>
        <a href="../../5_recipe/index.html">ãƒ¬ã‚·ãƒ”</a>
        <a href="../../6_chat/index.html">ãƒãƒ£ãƒƒãƒˆ</a>
        <a href="../../7_mypage/index.html">è‡ªåˆ†å­¦</a>
        <a href="../index.html">ãƒ©ãƒœ</a>
        <a href="../../9_archive/index.html">ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</a>
        <a href="../../10_contact/index.html">ãŠå•ã„åˆã‚ã›</a>
      </nav>
    </div>
  </header>

  <main>
    <!-- ãƒ—ãƒ­ã‚°ãƒ©ãƒ è©³ç´°ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <section class="detail-header">
      <div class="container">
        <h1 class="detail-title">ã¤ãã‚‹ãƒšãƒ¼ã‚¸</h1>
        <p class="detail-subtitle">ULTLAãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®åˆ¶ä½œãƒ—ãƒ­ã‚»ã‚¹ã‚’å¯è¦–åŒ–ã™ã‚‹å®Ÿé¨“å®¤</p>
        <div class="detail-meta">
          <span class="meta-item">ğŸ“‹ å…¨è­°äº‹éŒ²ç®¡ç†</span>
          <span class="meta-item">ğŸ” æ¨ªæ–­æ¤œç´¢å¯¾å¿œ</span>
          <span class="meta-item">ğŸ·ï¸ ã‚¿ã‚°åˆ†é¡ã‚·ã‚¹ãƒ†ãƒ </span>
          <span class="meta-item">ğŸ“Š ãƒ—ãƒ­ã‚»ã‚¹å¯è¦–åŒ–</span>
        </div>
      </div>
    </section>

    <div class="container">
      <!-- èªè¨¼çŠ¶æ…‹è¡¨ç¤º -->
      <section class="auth-section">
        <div id="authStatus">
          <!-- ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ -->
          <div id="loggedInStatus" style="display: none;">
            <div class="login-status">
              <div class="user-info">
                <span style="color: var(--ultla-green); font-weight: bold;">âœ… ãƒ­ã‚°ã‚¤ãƒ³ä¸­:</span>
                <span id="currentUser"></span>
              </div>
              <button id="logoutBtn" class="logout-btn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            </div>
            <button id="showUploadBtn" class="search-btn" style="margin-bottom: var(--spacing-md);">ğŸ“ æ–°ã—ã„è­°äº‹éŒ²ã‚’æŠ•ç¨¿</button>
          </div>
          
          <!-- æœªãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ -->
          <div id="notLoggedInStatus" style="display: none;">
            <div class="login-prompt">
              <p style="margin-bottom: var(--spacing-sm);">âš ï¸ ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“</p>
              <p>è­°äº‹éŒ²ã®æŠ•ç¨¿ãƒ»ç·¨é›†ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚</p>
              <a href="../auth-test.html" class="login-link">ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸ â†’</a>
            </div>
          </div>
        </div>
      </section>

      <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
      <div id="messageArea"></div>

      <!-- è­°äº‹éŒ²æŠ•ç¨¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <section id="uploadSection" class="upload-section">
        <div class="section-header">
          <h2 class="section-title">ğŸ“ è­°äº‹éŒ²æŠ•ç¨¿</h2>
          <p class="section-subtitle">ä¼šè­°ã®è¨˜éŒ²ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ã¨å…±æœ‰ã—ã¾ã—ã‚‡ã†</p>
        </div>

        <form class="upload-form" id="uploadForm">
          <div class="form-group">
            <label for="meetingTitle">ä¼šè­°ã‚¿ã‚¤ãƒˆãƒ« <span style="color: var(--ultla-red);">*</span></label>
            <input type="text" id="meetingTitle" required placeholder="ä¾‹ï¼šç¬¬3å› æµ·ã‚¨ãƒªã‚¢ä¼ç”»ä¼šè­°">
          </div>

          <div class="form-group">
            <label for="meetingDate">ä¼šè­°æ—¥ä»˜ <span style="color: var(--ultla-red);">*</span></label>
            <input type="date" id="meetingDate" required>
          </div>

          <div class="form-group">
            <label for="meetingParticipants">å‚åŠ è€…</label>
            <input type="text" id="meetingParticipants" placeholder="ä¾‹ï¼šç”°ä¸­ã€ä½è—¤ã€éŒå€‰å¸‚ãƒ»å±±ç”°æ°">
          </div>

          <div class="form-group">
            <label for="meetingDescription">å†…å®¹ãƒ»æ¦‚è¦ <span style="color: var(--ultla-red);">*</span></label>
            <textarea id="meetingDescription" rows="4" required placeholder="ä¼šè­°ã®å†…å®¹ã‚„ä¸»è¦ãªæ±ºå®šäº‹é …ãªã©"></textarea>
          </div>

          <div class="form-group">
            <label for="meetingTags">ã‚¿ã‚°ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
            <input type="text" id="meetingTags" placeholder="ä¾‹ï¼šæµ·,äº‹å‹™,åºƒå ±,ã‚³ãƒ1">
            <small style="color: var(--text-muted);">ğŸ’¡ ã‚¨ãƒªã‚¢ï¼ˆæµ·ãƒ»æ£®ï¼‰ã€ã‚«ãƒ†ã‚´ãƒªï¼ˆäº‹å‹™ãƒ»åºƒå ±ï¼‰ã€ãƒ†ãƒ¼ãƒã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆã‚³ãƒ1-4ãƒ»å…¨ä½“ï¼‰ãªã©</small>
          </div>

          <div class="form-group">
            <label for="meetingFile">è­°äº‹éŒ²ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä»»æ„ï¼‰</label>
            <div class="file-drop-zone" id="fileDropZone">
              <p>ğŸ“„ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã‹ã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</p>
              <p style="color: var(--text-muted); font-size: 0.9rem;">å¯¾å¿œå½¢å¼: PDF, Word, Excel, PowerPoint, ãƒ†ã‚­ã‚¹ãƒˆ</p>
            </div>
            <input type="file" id="meetingFile" style="display: none;" accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.md">
            <div class="file-info" id="fileInfo"></div>
          </div>

          <div style="display: flex; gap: var(--spacing-md);">
            <button type="submit" class="submit-btn" id="submitBtn" disabled>
              ğŸ“¤ è­°äº‹éŒ²ã‚’æŠ•ç¨¿
            </button>
            <button type="button" id="cancelUploadBtn" class="submit-btn" style="background: var(--text-muted); flex: 0 0 auto;">
              ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            </button>
          </div>
        </form>
      </section>

      <!-- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
      <section class="search-filter-section">
        <div class="search-container">
          <input type="text" class="search-input" placeholder="è­°äº‹éŒ²ã‚’æ¤œç´¢ï¼ˆãƒ•ãƒªãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼‰" id="searchInput">
          <button class="search-btn" onclick="performSearch()">æ¤œç´¢</button>
        </div>
        
        <div class="tag-filters">
          <span class="tag-filter active" data-tag="all">ã™ã¹ã¦</span>
          <span class="tag-filter area" data-tag="æµ·">æµ·</span>
          <span class="tag-filter area" data-tag="æ£®">æ£®</span>
          <span class="tag-filter category" data-tag="åºƒå ±">åºƒå ±</span>
          <span class="tag-filter category" data-tag="äº‹å‹™">äº‹å‹™</span>
          <span class="tag-filter theme" data-tag="èº«ä½“">èº«ä½“</span>
          <span class="tag-filter theme" data-tag="éœŠæ€§">éœŠæ€§</span>
          <span class="tag-filter theme" data-tag="ç™ºæ•£">ç™ºæ•£</span>
          <span class="tag-filter theme" data-tag="åæŸ">åæŸ</span>
          <span class="tag-filter theme" data-tag="å†…çœ">å†…çœ</span>
          <span class="tag-filter program" data-tag="ã‚³ãƒ1">ã‚³ãƒ1</span>
          <span class="tag-filter program" data-tag="ã‚³ãƒ2">ã‚³ãƒ2</span>
          <span class="tag-filter program" data-tag="ã‚³ãƒ3">ã‚³ãƒ3</span>
          <span class="tag-filter program" data-tag="ã‚³ãƒ4">ã‚³ãƒ4</span>
          <span class="tag-filter program" data-tag="å…¨ä½“">å…¨ä½“</span>
        </div>
      </section>

      <!-- æ¤œç´¢çµæœæƒ…å ± -->
      <div class="results-info">
        <span class="results-count" id="resultsCount">è­°äº‹éŒ²ã‚’èª­ã¿è¾¼ã¿ä¸­...</span>
        <select class="sort-select" id="sortSelect" onchange="sortResults()">
          <option value="date-desc">æ–°ã—ã„é †</option>
          <option value="date-asc">å¤ã„é †</option>
          <option value="relevance">é–¢é€£åº¦é †</option>
        </select>
      </div>

      <!-- è­°äº‹éŒ²ã‚«ãƒ¼ãƒ‰ä¸€è¦§ -->
      <section class="minutes-grid" id="minutesGrid">
        <div class="loading-message">è­°äº‹éŒ²ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</div>
      </section>
    </div>
  </main>

  <footer>
    <div class="container">
      <small>Â© 2025 ULTLA Fan Community</small>
    </div>
  </footer>

  <!-- Firebaseè¨­å®šï¼ˆå®Ÿéš›ã®ãƒ‘ã‚¹æ§‹é€ ã«åˆã‚ã›ã¦èª¿æ•´ï¼‰ -->
  <script type="module" src="../firebase-test.js"></script>
  
  <!-- è­°äº‹éŒ²ç®¡ç†æ©Ÿèƒ½ -->
  <script type="module">
    import { db, storage, authReady, auth } from '../firebase-test.js';
    import {
      collection,
      addDoc,
      serverTimestamp,
      query,
      where,
      orderBy,
      onSnapshot,
      doc,
      getDoc,
      setDoc,
      getDocs,
      updateDoc,
      deleteDoc
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
    import {
      ref,
      uploadBytes,
      getDownloadURL
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";
    import {
      signOut
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
    let currentUID = null;
    let userProfile = null;
    let selectedFile = null;
    let allMeetingRecords = [];

    // DOMè¦ç´ 
    const loggedInStatus = document.getElementById('loggedInStatus');
    const notLoggedInStatus = document.getElementById('notLoggedInStatus');
    const currentUser = document.getElementById('currentUser');
    const logoutBtn = document.getElementById('logoutBtn');
    const showUploadBtn = document.getElementById('showUploadBtn');
    const uploadSection = document.getElementById('uploadSection');
    const cancelUploadBtn = document.getElementById('cancelUploadBtn');
    const messageArea = document.getElementById('messageArea');
    const minutesGrid = document.getElementById('minutesGrid');
    const resultsCount = document.getElementById('resultsCount');

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—
    async function getUserProfile(uid) {
      if (!uid) return null;
      try {
        const profileRef = doc(db, "userProfiles", uid);
        const profileSnap = await getDoc(profileRef);
        return profileSnap.exists() ? profileSnap.data() : null;
      } catch (error) {
        console.error("ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—ã‚¨ãƒ©ãƒ¼:", error);
        return null;
      }
    }

    // èªè¨¼çŠ¶æ…‹è¡¨ç¤ºæ›´æ–°
    async function updateAuthDisplay(user) {
      if (user) {
        currentUID = user.uid;
        userProfile = await getUserProfile(user.uid);
        
        let displayText;
        if (userProfile && userProfile.username) {
          displayText = `${userProfile.username}ã•ã‚“`;
        } else {
          const email = user.email || `åŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼ (${user.uid.substring(0, 8)}...)`;
          displayText = email;
        }
        
        const authMethod = user.isAnonymous ? 'åŒ¿å' : (user.providerData[0]?.providerId === 'google.com' ? 'Google' : 'ãƒ¡ãƒ¼ãƒ«');
        currentUser.innerHTML = `${displayText} <small style="color: #666;">(${authMethod}èªè¨¼)</small>`;
        
        loggedInStatus.style.display = 'block';
        notLoggedInStatus.style.display = 'none';
      } else {
        currentUID = null;
        userProfile = null;
        loggedInStatus.style.display = 'none';
        notLoggedInStatus.style.display = 'block';
      }
    }

    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
    function showMessage(message, type = 'info') {
      const messageDiv = document.createElement('div');
      messageDiv.className = `${type}-message`;
      messageDiv.textContent = message;
      messageArea.innerHTML = '';
      messageArea.appendChild(messageDiv);
      
      setTimeout(() => {
        messageDiv.remove();
      }, 5000);
    }

    // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
    async function handleLogout() {
      try {
        await signOut(auth);
        showMessage('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ', 'success');
        setTimeout(() => {
          window.location.href = '../auth-test.html';
        }, 1000);
      } catch (error) {
        console.error("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼:", error);
        showMessage('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'error');
      }
    }

    // è­°äº‹éŒ²ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰è¡¨ç¤º/éè¡¨ç¤º
    function toggleUploadSection() {
      if (uploadSection.classList.contains('show')) {
        uploadSection.classList.remove('show');
        showUploadBtn.textContent = 'ğŸ“ æ–°ã—ã„è­°äº‹éŒ²ã‚’æŠ•ç¨¿';
      } else {
        uploadSection.classList.add('show');
        showUploadBtn.textContent = 'ğŸ“ æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‰ã˜ã‚‹';
        document.getElementById('meetingDate').value = new Date().toISOString().split('T')[0];
      }
    }

    // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå‡¦ç†
    const fileDropZone = document.getElementById('fileDropZone');
    const meetingFile = document.getElementById('meetingFile');
    const fileInfo = document.getElementById('fileInfo');
    const submitBtn = document.getElementById('submitBtn');

    fileDropZone.addEventListener('click', () => meetingFile.click());

    fileDropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      fileDropZone.classList.add('dragover');
    });

    fileDropZone.addEventListener('dragleave', () => {
      fileDropZone.classList.remove('dragover');
    });

    fileDropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      fileDropZone.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        handleFileSelect(files[0]);
      }
    });

    meetingFile.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        handleFileSelect(e.target.files[0]);
      }
    });

    function handleFileSelect(file) {
      selectedFile = file;
      fileInfo.style.display = 'block';
      fileInfo.innerHTML = `
        <h4>é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«:</h4>
        <p><strong>åå‰:</strong> ${file.name}</p>
        <p><strong>ã‚µã‚¤ã‚º:</strong> ${(file.size / 1024 / 1024).toFixed(2)} MB</p>
        <p><strong>ç¨®é¡:</strong> ${file.type || 'ä¸æ˜'}</p>
      `;
      updateSubmitButton();
    }

    function updateSubmitButton() {
      const title = document.getElementById('meetingTitle').value.trim();
      const date = document.getElementById('meetingDate').value;
      const description = document.getElementById('meetingDescription').value.trim();
      
      if (title && date && description) {
        submitBtn.disabled = false;
      } else {
        submitBtn.disabled = true;
      }
    }

    // ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ç›£è¦–
    document.getElementById('meetingTitle').addEventListener('input', updateSubmitButton);
    document.getElementById('meetingDate').addEventListener('input', updateSubmitButton);
    document.getElementById('meetingDescription').addEventListener('input', updateSubmitButton);

    // è­°äº‹éŒ²æŠ•ç¨¿å‡¦ç†
    document.getElementById('uploadForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (!currentUID) {
        showMessage('ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™', 'error');
        return;
      }

      const formData = {
        title: document.getElementById('meetingTitle').value.trim(),
        meetingDate: new Date(document.getElementById('meetingDate').value),
        participants: document.getElementById('meetingParticipants').value.trim() || '',
        description: document.getElementById('meetingDescription').value.trim(),
        tags: document.getElementById('meetingTags').value.split(',').map(tag => tag.trim()).filter(tag => tag !== '')
      };

      submitBtn.disabled = true;
      submitBtn.textContent = 'ğŸ“¤ æŠ•ç¨¿ä¸­...';

      try {
        let fileUrl = '';
        let fileName = '';
        let fileSize = 0;
        let fileType = '';

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
        if (selectedFile) {
          const fileStorageName = `meeting_records/${currentUID}_${Date.now()}_${selectedFile.name}`;
          const fileRef = ref(storage, fileStorageName);
          const snapshot = await uploadBytes(fileRef, selectedFile);
          fileUrl = await getDownloadURL(snapshot.ref);
          fileName = selectedFile.name;
          fileSize = selectedFile.size;
          fileType = selectedFile.type;
        }

        // Firestoreã«ä¿å­˜
        const recordData = {
          uid: currentUID,
          uploaderName: userProfile ? userProfile.displayName : 'åŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼',
          title: formData.title,
          meetingDate: formData.meetingDate,
          participants: formData.participants,
          description: formData.description,
          tags: formData.tags,
          fileUrl,
          fileName,
          fileSize,
          fileType,
          project: 'ULTLA2025',
          status: 'published',
          createdAt: serverTimestamp(),
          updatedAt: serverTimestamp()
        };

        await addDoc(collection(db, "meetingRecords"), recordData);
        
        showMessage('è­°äº‹éŒ²ãŒæ­£å¸¸ã«æŠ•ç¨¿ã•ã‚Œã¾ã—ãŸï¼', 'success');
        
        // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        document.getElementById('uploadForm').reset();
        selectedFile = null;
        fileInfo.style.display = 'none';
        toggleUploadSection();
        updateSubmitButton();

      } catch (error) {
        console.error('æŠ•ç¨¿ã‚¨ãƒ©ãƒ¼:', error);
        showMessage('æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'error');
      } finally {
        submitBtn.textContent = 'ğŸ“¤ è­°äº‹éŒ²ã‚’æŠ•ç¨¿';
      }
    });

    // è­°äº‹éŒ²ä¸€è¦§è¡¨ç¤ºï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å•é¡Œå¯¾å¿œç‰ˆï¼‰
    function displayMeetingRecords() {
      const recordsRef = collection(db, "meetingRecords");
      // ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¯ã‚¨ãƒªã«å¤‰æ›´ï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä¸è¦ï¼‰
      const q = query(recordsRef, where("project", "==", "ULTLA2025"));
      
      onSnapshot(q, (querySnapshot) => {
        allMeetingRecords = [];
        
        querySnapshot.forEach((doc) => {
          const record = doc.data();
          allMeetingRecords.push({
            id: doc.id,
            ...record
          });
        });
        
        // ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§æ—¥ä»˜ã‚½ãƒ¼ãƒˆ
        allMeetingRecords.sort((a, b) => {
          const dateA = a.meetingDate?.toDate ? a.meetingDate.toDate() : new Date(a.meetingDate);
          const dateB = b.meetingDate?.toDate ? b.meetingDate.toDate() : new Date(b.meetingDate);
          return dateB - dateA; // æ–°ã—ã„é †
        });
        
        renderMeetingRecords(allMeetingRecords);
        updateResultsCount(allMeetingRecords.length);
      }, (error) => {
        console.error("è­°äº‹éŒ²èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:", error);
        minutesGrid.innerHTML = '<div class="error-message">è­°äº‹éŒ²ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
      });
    }

    // è­°äº‹éŒ²ã‚«ãƒ¼ãƒ‰æç”»
    function renderMeetingRecords(records) {
      if (records.length === 0) {
        minutesGrid.innerHTML = '<div class="loading-message">è­°äº‹éŒ²ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</div>';
        return;
      }

      minutesGrid.innerHTML = '';
      
      records.forEach(record => {
        const cardElement = createMeetingRecordCard(record);
        minutesGrid.appendChild(cardElement);
      });
    }

    // è­°äº‹éŒ²ã‚«ãƒ¼ãƒ‰ä½œæˆ
    function createMeetingRecordCard(record) {
      const element = document.createElement('article');
      element.className = 'minutes-card';
      element.setAttribute('data-tags', record.tags ? record.tags.join(',') : '');

      const meetingDate = record.meetingDate ? 
        (record.meetingDate.toDate ? record.meetingDate.toDate() : new Date(record.meetingDate)) :
        new Date();

      const isOwner = record.uid === currentUID;

      element.innerHTML = `
        <div class="minutes-header">
          <div>
            <h3 class="minutes-title">${escapeHTML(record.title)}</h3>
            ${record.participants ? `<p class="minutes-participants">å‚åŠ è€…: ${escapeHTML(record.participants)}</p>` : ''}
          </div>
          <span class="minutes-date">${meetingDate.toLocaleDateString('ja-JP')}</span>
        </div>
        
        <div class="minutes-content">
          ${escapeHTML(record.description)}
        </div>
        
        ${record.tags && record.tags.length > 0 ? `
          <div class="minutes-tags">
            ${record.tags.map(tag => {
              let tagClass = 'tag-theme';
              if (['æµ·', 'æ£®'].includes(tag)) tagClass = 'tag-area';
              else if (['äº‹å‹™', 'åºƒå ±'].includes(tag)) tagClass = 'tag-category';
              else if (['ã‚³ãƒ1', 'ã‚³ãƒ2', 'ã‚³ãƒ3', 'ã‚³ãƒ4', 'å…¨ä½“'].includes(tag)) tagClass = 'tag-program';
              
              return `<span class="minutes-tag ${tagClass}">${escapeHTML(tag)}</span>`;
            }).join('')}
          </div>
        ` : ''}
        
        <div class="minutes-actions">
          <div>
            ${record.fileUrl ? `<a href="${record.fileUrl}" target="_blank" class="view-detail-btn">ğŸ“„ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã</a>` : ''}
          </div>
          <div>
            <small style="color: var(--text-muted);">æŠ•ç¨¿è€…: ${escapeHTML(record.uploaderName)}</small>
            ${isOwner ? `
              <button class="edit-btn" onclick="editRecord('${record.id}')">ç·¨é›†</button>
              <button class="delete-btn" onclick="deleteRecord('${record.id}')">å‰Šé™¤</button>
            ` : ''}
          </div>
        </div>
      `;

      return element;
    }

    // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
    function escapeHTML(str) {
      if (typeof str !== 'string') return '';
      return str.replace(/[&<>"']/g, function (match) {
        return {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;',
        }[match];
      });
    }

    // çµæœä»¶æ•°æ›´æ–°
    function updateResultsCount(count) {
      resultsCount.textContent = `${count}ä»¶ã®è­°äº‹éŒ²ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`;
    }

    // æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚’æ´»ç”¨ï¼‰
    window.performSearch = function() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      
      if (!searchTerm.trim()) {
        renderMeetingRecords(allMeetingRecords);
        updateResultsCount(allMeetingRecords.length);
        return;
      }

      const filteredRecords = allMeetingRecords.filter(record => {
        const searchableText = `${record.title} ${record.description} ${record.participants || ''} ${(record.tags || []).join(' ')}`.toLowerCase();
        return searchableText.includes(searchTerm);
      });

      renderMeetingRecords(filteredRecords);
      updateResultsCount(filteredRecords.length);
    };

    // ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
    document.querySelectorAll('.tag-filter').forEach(tag => {
      tag.addEventListener('click', function() {
        document.querySelectorAll('.tag-filter').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        
        const selectedTag = this.dataset.tag;
        filterByTag(selectedTag);
      });
    });

    function filterByTag(tag) {
      if (tag === 'all') {
        renderMeetingRecords(allMeetingRecords);
        updateResultsCount(allMeetingRecords.length);
        return;
      }

      const filteredRecords = allMeetingRecords.filter(record => {
        return record.tags && record.tags.includes(tag);
      });

      renderMeetingRecords(filteredRecords);
      updateResultsCount(filteredRecords.length);
    }

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ï¼ˆç·¨é›†ãƒ»å‰Šé™¤ç”¨ï¼‰
    window.editRecord = function(recordId) {
      showMessage('ç·¨é›†æ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™', 'info');
    };

    window.deleteRecord = function(recordId) {
      if (confirm('ã“ã®è­°äº‹éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nâ€»ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
        deleteDoc(doc(db, "meetingRecords", recordId))
          .then(() => {
            showMessage('è­°äº‹éŒ²ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ', 'success');
          })
          .catch((error) => {
            console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
            showMessage('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
          });
      }
    };

    window.sortResults = function() {
      const sortBy = document.getElementById('sortSelect').value;
      const currentRecords = [...allMeetingRecords];
      
      currentRecords.sort((a, b) => {
        if (sortBy === 'date-desc') {
          const dateA = a.meetingDate?.toDate ? a.meetingDate.toDate() : new Date(a.meetingDate);
          const dateB = b.meetingDate?.toDate ? b.meetingDate.toDate() : new Date(b.meetingDate);
          return dateB - dateA;
        } else if (sortBy === 'date-asc') {
          const dateA = a.meetingDate?.toDate ? a.meetingDate.toDate() : new Date(a.meetingDate);
          const dateB = b.meetingDate?.toDate ? b.meetingDate.toDate() : new Date(b.meetingDate);
          return dateA - dateB;
        }
        return 0;
      });
      
      renderMeetingRecords(currentRecords);
    };

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
    logoutBtn.addEventListener('click', handleLogout);
    showUploadBtn.addEventListener('click', toggleUploadSection);
    cancelUploadBtn.addEventListener('click', toggleUploadSection);

    // æ¤œç´¢å…¥åŠ›ã§Enterã‚­ãƒ¼å¯¾å¿œ
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        performSearch();
      }
    });

    // åˆæœŸåŒ–æ™‚ã«URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆæ—¢å­˜æ©Ÿèƒ½ï¼‰
    document.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      const filterTag = urlParams.get('filter');
      
      if (filterTag) {
        const targetTag = document.querySelector(`[data-tag="${filterTag}"]`);
        if (targetTag) {
          document.querySelectorAll('.tag-filter').forEach(t => t.classList.remove('active'));
          targetTag.classList.add('active');
          // filterByTag ã¯ displayMeetingRecords å®Œäº†å¾Œã«å®Ÿè¡Œ
        }
      }
    });

    // èªè¨¼å®Œäº†å¾Œã®å‡¦ç†
    authReady.then(async (user) => {
      console.log("ã¤ãã‚‹ãƒšãƒ¼ã‚¸èªè¨¼å®Œäº†:", user);
      await updateAuthDisplay(user);
      
      // è­°äº‹éŒ²ä¸€è¦§ã‚’è¡¨ç¤º
      displayMeetingRecords();
      
      // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‡¦ç†ï¼ˆé…å»¶å®Ÿè¡Œï¼‰
      setTimeout(() => {
        const urlParams = new URLSearchParams(window.location.search);
        const filterTag = urlParams.get('filter');
        if (filterTag && filterTag !== 'all') {
          filterByTag(filterTag);
        }
      }, 1000);
      
    }).catch(error => {
      console.error("ã¤ãã‚‹ãƒšãƒ¼ã‚¸èªè¨¼å‡¦ç†ã‚¨ãƒ©ãƒ¼:", error);
      updateAuthDisplay(null);
      minutesGrid.innerHTML = '<div class="error-message">èªè¨¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</div>';
    });

    console.log("ã¤ãã‚‹ãƒšãƒ¼ã‚¸ãŒåˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ");
  </script>
</body>
</html>
