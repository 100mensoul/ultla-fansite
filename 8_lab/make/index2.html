<!DOCTYPE html>

<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã¤ãã‚‹ãƒšãƒ¼ã‚¸ | ULTLAãƒ©ãƒœ</title>
  <link rel="stylesheet" href="../../style.css">
  <style>
    /* æ”¹ä¿®ç‰ˆã‚¹ã‚¿ã‚¤ãƒ« - ãƒ¢ãƒ€ãƒ³ãªãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ  */

```
:root {
  --primary-gradient: linear-gradient(135deg, var(--ultla-blue) 0%, #007BB8 100%);
  --success-gradient: linear-gradient(135deg, var(--ultla-green) 0%, #00a86b 100%);
  --warning-gradient: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
  --glassmorphism: rgba(255, 255, 255, 0.1);
  --glassmorphism-border: rgba(255, 255, 255, 0.2);
  --box-shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.1);
  --box-shadow-hover: 0 12px 40px rgba(0, 0, 0, 0.15);
  --border-radius-card: 16px;
  --border-radius-button: 12px;
  --animation-smooth: cubic-bezier(0.4, 0, 0.2, 1);
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.detail-header {
  background: var(--primary-gradient);
  color: white;
  padding: var(--spacing-2xl) 0;
  margin-bottom: var(--spacing-2xl);
  position: relative;
  overflow: hidden;
  border-radius: 0 0 var(--border-radius-card) var(--border-radius-card);
}

.detail-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: 
    radial-gradient(circle at 30% 40%, rgba(255,255,255,0.2) 0%, transparent 50%),
    radial-gradient(circle at 70% 80%, rgba(0,163,217,0.3) 0%, transparent 40%);
  z-index: 1;
}

.detail-header .container {
  position: relative;
  z-index: 2;
}

.detail-title {
  font-size: clamp(2.5rem, 6vw, 4rem);
  margin-bottom: var(--spacing-md);
  font-weight: 600;
  letter-spacing: -0.02em;
  background: linear-gradient(135deg, #ffffff 0%, #f0f9ff 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.detail-subtitle {
  font-size: 1.3rem;
  opacity: 0.95;
  margin-bottom: var(--spacing-lg);
  font-weight: 400;
}

.detail-meta {
  display: flex;
  gap: var(--spacing-md);
  flex-wrap: wrap;
  font-size: 0.95rem;
}

.meta-item {
  background: var(--glassmorphism);
  border: 1px solid var(--glassmorphism-border);
  padding: var(--spacing-sm) var(--spacing-md);
  border-radius: var(--border-radius-button);
  backdrop-filter: blur(10px);
  transition: all 0.3s var(--animation-smooth);
}

.meta-item:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: translateY(-2px);
}

/* èªè¨¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.auth-section {
  background: var(--bg-card);
  padding: var(--spacing-xl);
  border-radius: var(--border-radius-card);
  margin-bottom: var(--spacing-2xl);
  box-shadow: var(--box-shadow-soft);
  text-align: center;
  border: 1px solid var(--border-light);
}

.login-status {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--spacing-md);
  padding: var(--spacing-md);
  background: var(--bg-light);
  border-radius: var(--border-radius-button);
}

.user-info {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

.user-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: var(--success-gradient);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 600;
  font-size: 0.9rem;
}

.logout-btn {
  background: var(--warning-gradient);
  color: white;
  border: none;
  padding: var(--spacing-sm) var(--spacing-md);
  border-radius: var(--border-radius-button);
  cursor: pointer;
  font-size: 0.9rem;
  font-weight: 500;
  transition: all 0.3s var(--animation-smooth);
  box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
}

.logout-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(255, 107, 107, 0.4);
}

.action-buttons {
  display: flex;
  gap: var(--spacing-md);
  flex-wrap: wrap;
  margin-top: var(--spacing-md);
}

.primary-btn {
  background: var(--primary-gradient);
  color: white;
  border: none;
  padding: var(--spacing-md) var(--spacing-lg);
  border-radius: var(--border-radius-button);
  cursor: pointer;
  font-weight: 500;
  transition: all 0.3s var(--animation-smooth);
  box-shadow: 0 4px 12px rgba(0, 163, 217, 0.3);
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.primary-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0, 163, 217, 0.4);
  color: white;
}

.secondary-btn {
  background: var(--success-gradient);
  color: white;
  border: none;
  padding: var(--spacing-md) var(--spacing-lg);
  border-radius: var(--border-radius-button);
  cursor: pointer;
  font-weight: 500;
  transition: all 0.3s var(--animation-smooth);
  box-shadow: 0 4px 12px rgba(0, 184, 148, 0.3);
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.secondary-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0, 184, 148, 0.4);
  color: white;
}

/* è­°äº‹éŒ²æŠ•ç¨¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.upload-section {
  background: var(--bg-card);
  padding: var(--spacing-2xl);
  border-radius: var(--border-radius-card);
  margin-bottom: var(--spacing-2xl);
  box-shadow: var(--box-shadow-soft);
  border: 2px dashed var(--border-light);
  transition: all 0.3s var(--animation-smooth);
  display: none;
}

.upload-section.show {
  display: block;
  border-color: var(--ultla-blue);
  background: rgba(0, 163, 217, 0.02);
}

.upload-section.dragover {
  border-color: var(--ultla-green);
  background: rgba(0, 184, 148, 0.05);
  transform: scale(1.01);
}

.upload-form {
  max-width: 700px;
  margin: 0 auto;
}

.form-group {
  margin-bottom: var(--spacing-lg);
}

.form-group label {
  display: block;
  margin-bottom: var(--spacing-sm);
  font-weight: 600;
  color: var(--text-primary);
  font-size: 0.95rem;
}

.form-group input,
.form-group textarea,
.form-group select {
  width: 100%;
  padding: var(--spacing-md);
  border: 2px solid var(--border-light);
  border-radius: var(--border-radius-button);
  font-size: 1rem;
  box-sizing: border-box;
  transition: all 0.3s var(--animation-smooth);
  background: white;
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
  outline: none;
  border-color: var(--ultla-blue);
  box-shadow: 0 0 0 4px rgba(0, 163, 217, 0.1);
  transform: translateY(-1px);
}

.file-drop-zone {
  border: 2px dashed var(--border-light);
  border-radius: var(--border-radius-card);
  padding: var(--spacing-2xl);
  text-align: center;
  transition: all 0.3s var(--animation-smooth);
  cursor: pointer;
  margin-bottom: var(--spacing-md);
  background: var(--bg-light);
}

.file-drop-zone.dragover {
  border-color: var(--ultla-blue);
  background: rgba(0, 163, 217, 0.05);
  transform: scale(1.02);
}

.file-drop-zone:hover {
  border-color: var(--ultla-green);
  background: rgba(0, 184, 148, 0.05);
}

.file-info {
  background: var(--bg-light);
  padding: var(--spacing-lg);
  border-radius: var(--border-radius-button);
  margin-top: var(--spacing-md);
  display: none;
  border-left: 4px solid var(--ultla-green);
}

.submit-btn {
  background: var(--primary-gradient);
  color: white;
  padding: var(--spacing-lg) var(--spacing-2xl);
  border: none;
  border-radius: var(--border-radius-button);
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s var(--animation-smooth);
  box-shadow: var(--box-shadow-soft);
  width: 100%;
}

.submit-btn:hover:not(:disabled) {
  transform: translateY(-3px);
  box-shadow: var(--box-shadow-hover);
}

.submit-btn:disabled {
  background: var(--text-muted);
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

/* ã‚¿ã‚¹ã‚¯æŠ½å‡ºãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
.task-preview-section {
  background: linear-gradient(135deg, #f8f9ff 0%, #e6f3ff 100%);
  border: 2px solid var(--ultla-blue);
  border-radius: var(--border-radius-card);
  padding: var(--spacing-xl);
  margin-top: var(--spacing-lg);
  display: none;
  animation: slideIn 0.5s var(--animation-smooth);
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.task-preview-section.show {
  display: block;
}

.task-preview-title {
  color: var(--ultla-blue);
  font-size: 1.2rem;
  font-weight: 600;
  margin-bottom: var(--spacing-lg);
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

.preview-item {
  background: white;
  padding: var(--spacing-md);
  border-radius: var(--border-radius-button);
  margin-bottom: var(--spacing-sm);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: all 0.3s var(--animation-smooth);
}

.preview-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.task-item {
  border-left: 4px solid var(--ultla-green);
}

.meeting-item {
  border-left: 4px solid var(--ultla-blue);
}

.decision-item {
  border-left: 4px solid var(--ultla-red);
}

.item-content {
  font-weight: 500;
  margin-bottom: var(--spacing-xs);
  color: var(--text-primary);
}

.item-meta {
  font-size: 0.85rem;
  color: var(--text-muted);
}

/* æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.search-filter-section {
  background: var(--bg-card);
  padding: var(--spacing-xl);
  border-radius: var(--border-radius-card);
  margin-bottom: var(--spacing-2xl);
  box-shadow: var(--box-shadow-soft);
  border: 1px solid var(--border-light);
}

.search-container {
  display: flex;
  gap: var(--spacing-md);
  margin-bottom: var(--spacing-lg);
  flex-wrap: wrap;
}

.search-input {
  flex: 1;
  min-width: 300px;
  padding: var(--spacing-md) var(--spacing-lg);
  border: 2px solid var(--border-light);
  border-radius: var(--border-radius-button);
  font-size: 1rem;
  transition: all 0.3s var(--animation-smooth);
  background: white;
}

.search-input:focus {
  outline: none;
  border-color: var(--ultla-blue);
  box-shadow: 0 0 0 4px rgba(0, 163, 217, 0.1);
}

.search-btn {
  padding: var(--spacing-md) var(--spacing-xl);
  background: var(--primary-gradient);
  color: white;
  border: none;
  border-radius: var(--border-radius-button);
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s var(--animation-smooth);
  box-shadow: 0 4px 12px rgba(0, 163, 217, 0.3);
}

.search-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0, 163, 217, 0.4);
}

/* ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ */
.tag-filters {
  display: flex;
  gap: var(--spacing-sm);
  flex-wrap: wrap;
  margin-bottom: var(--spacing-md);
}

.tag-filter {
  padding: var(--spacing-sm) var(--spacing-md);
  background: var(--bg-light);
  border: 2px solid var(--border-light);
  border-radius: var(--radius-full);
  font-size: 0.9rem;
  cursor: pointer;
  transition: all 0.3s var(--animation-smooth);
  user-select: none;
  font-weight: 500;
}

.tag-filter:hover {
  background: rgba(0, 163, 217, 0.1);
  border-color: var(--ultla-blue);
  transform: translateY(-1px);
}

.tag-filter.active {
  background: var(--ultla-blue);
  color: white;
  border-color: var(--ultla-blue);
  box-shadow: 0 2px 8px rgba(0, 163, 217, 0.3);
}

.tag-filter.area {
  background: var(--ultla-blue);
  color: white;
  border-color: var(--ultla-blue);
}

.tag-filter.category {
  background: var(--ultla-green);
  color: white;
  border-color: var(--ultla-green);
}

.tag-filter.theme {
  background: var(--ultla-red);
  color: white;
  border-color: var(--ultla-red);
}

.tag-filter.program {
  background: #6c63ff;
  color: white;
  border-color: #6c63ff;
}

/* è­°äº‹éŒ²ã‚«ãƒ¼ãƒ‰ */
.minutes-grid {
  display: grid;
  gap: var(--spacing-xl);
}

.minutes-card {
  background: var(--bg-card);
  border-radius: var(--border-radius-card);
  padding: var(--spacing-xl);
  box-shadow: var(--box-shadow-soft);
  border: 1px solid var(--border-light);
  transition: all 0.3s var(--animation-smooth);
  position: relative;
  overflow: hidden;
}

.minutes-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 4px;
  height: 100%;
  background: var(--primary-gradient);
  transform: scaleY(0);
  transition: transform 0.3s var(--animation-smooth);
}

.minutes-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--box-shadow-hover);
}

.minutes-card:hover::before {
  transform: scaleY(1);
}

.minutes-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: var(--spacing-lg);
}

.minutes-date {
  font-size: 0.9rem;
  color: var(--text-muted);
  background: var(--bg-light);
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--radius-full);
  font-weight: 500;
}

.minutes-title {
  font-size: 1.3rem;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: var(--spacing-sm);
  line-height: 1.3;
}

.minutes-participants {
  font-size: 0.9rem;
  color: var(--text-secondary);
  margin-bottom: var(--spacing-md);
}

.minutes-content {
  color: var(--text-secondary);
  line-height: 1.7;
  margin-bottom: var(--spacing-lg);
}

.minutes-tags {
  display: flex;
  gap: var(--spacing-xs);
  flex-wrap: wrap;
  margin-bottom: var(--spacing-lg);
}

.minutes-tag {
  font-size: 0.8rem;
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--radius-full);
  font-weight: 500;
}

.tag-area { 
  background: rgba(0,163,217,0.15); 
  color: var(--ultla-blue);
  border: 1px solid rgba(0,163,217,0.3);
}
.tag-category { 
  background: rgba(0,184,148,0.15); 
  color: var(--ultla-green);
  border: 1px solid rgba(0,184,148,0.3);
}
.tag-theme { 
  background: rgba(255,107,107,0.15); 
  color: var(--ultla-red);
  border: 1px solid rgba(255,107,107,0.3);
}
.tag-program { 
  background: rgba(108,99,255,0.15); 
  color: #6C63FF;
  border: 1px solid rgba(108,99,255,0.3);
}

/* æŠ½å‡ºã‚¿ã‚¹ã‚¯è¡¨ç¤º */
.extracted-tasks {
  background: rgba(0,163,217,0.05);
  border: 1px solid rgba(0,163,217,0.2);
  border-radius: var(--border-radius-button);
  padding: var(--spacing-lg);
  margin-top: var(--spacing-lg);
}

.extracted-tasks-title {
  font-size: 1rem;
  font-weight: 600;
  color: var(--ultla-blue);
  margin-bottom: var(--spacing-md);
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.extracted-task-item {
  background: white;
  padding: var(--spacing-sm) var(--spacing-md);
  border-radius: var(--border-radius-button);
  margin-bottom: var(--spacing-sm);
  font-size: 0.9rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  transition: all 0.3s var(--animation-smooth);
}

.extracted-task-item:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
}

.extracted-task-item:last-child {
  margin-bottom: 0;
}

.minutes-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: var(--spacing-md);
  border-top: 1px solid var(--border-light);
}

.view-detail-btn {
  color: var(--ultla-blue);
  text-decoration: none;
  font-size: 0.95rem;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  transition: all 0.3s var(--animation-smooth);
  padding: var(--spacing-sm) var(--spacing-md);
  border-radius: var(--border-radius-button);
}

.view-detail-btn:hover {
  color: var(--ultla-green);
  background: rgba(0, 184, 148, 0.1);
  transform: translateX(4px);
}

.view-detail-btn::after {
  content: "â†’";
  transition: transform 0.3s var(--animation-smooth);
}

.view-detail-btn:hover::after {
  transform: translateX(4px);
}

.action-btn {
  padding: var(--spacing-xs) var(--spacing-sm);
  border: none;
  border-radius: var(--border-radius-button);
  cursor: pointer;
  font-size: 0.8rem;
  font-weight: 500;
  margin-left: var(--spacing-xs);
  transition: all 0.3s var(--animation-smooth);
}

.edit-btn {
  background: var(--primary-gradient);
  color: white;
  box-shadow: 0 2px 6px rgba(0, 163, 217, 0.3);
}

.edit-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 10px rgba(0, 163, 217, 0.4);
}

.delete-btn {
  background: var(--warning-gradient);
  color: white;
  box-shadow: 0 2px 6px rgba(255, 107, 107, 0.3);
}

.delete-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 10px rgba(255, 107, 107, 0.4);
}

/* çµæœè¡¨ç¤º */
.results-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--spacing-xl);
  padding: var(--spacing-lg);
  background: var(--bg-light);
  border-radius: var(--border-radius-button);
  border: 1px solid var(--border-light);
}

.results-count {
  font-size: 1rem;
  color: var(--text-primary);
  font-weight: 500;
}

.sort-select {
  padding: var(--spacing-sm) var(--spacing-md);
  border: 2px solid var(--border-light);
  border-radius: var(--border-radius-button);
  font-size: 0.9rem;
  background: white;
  cursor: pointer;
  transition: all 0.3s var(--animation-smooth);
}

.sort-select:focus {
  outline: none;
  border-color: var(--ultla-blue);
}

/* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º */
.loading-message {
  text-align: center;
  padding: var(--spacing-2xl);
  color: var(--text-muted);
  font-size: 1.1rem;
}

.error-message {
  background: linear-gradient(135deg, #fee 0%, #fdd 100%);
  border: 1px solid #faa;
  color: #a00;
  padding: var(--spacing-lg);
  border-radius: var(--border-radius-button);
  margin-bottom: var(--spacing-md);
  border-left: 4px solid #f00;
}

.success-message {
  background: linear-gradient(135deg, #efe 0%, #dfd 100%);
  border: 1px solid #afa;
  color: #090;
  padding: var(--spacing-lg);
  border-radius: var(--border-radius-button);
  margin-bottom: var(--spacing-md);
  border-left: 4px solid #0a0;
}

.info-message {
  background: linear-gradient(135deg, #e6f3ff 0%, #cce7ff 100%);
  border: 1px solid #99d6ff;
  color: #0066cc;
  padding: var(--spacing-lg);
  border-radius: var(--border-radius-button);
  margin-bottom: var(--spacing-md);
  border-left: 4px solid #0088ff;
}

/* ã‚¿ã‚¹ã‚¯æŠ½å‡ºãƒœã‚¿ãƒ³ */
.preview-btn {
  background: var(--success-gradient);
  color: white;
  border: none;
  padding: var(--spacing-sm) var(--spacing-md);
  border-radius: var(--border-radius-button);
  font-size: 0.9rem;
  font-weight: 500;
  cursor: pointer;
  margin-left: var(--spacing-sm);
  transition: all 0.3s var(--animation-smooth);
  box-shadow: 0 2px 6px rgba(0, 184, 148, 0.3);
}

.preview-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0, 184, 148, 0.4);
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ */
@media (max-width: 768px) {
  .detail-title {
    font-size: clamp(2rem, 8vw, 2.5rem);
  }
  
  .detail-meta {
    justify-content: center;
  }
  
  .login-status {
    flex-direction: column;
    gap: var(--spacing-md);
  }
  
  .action-buttons {
    justify-content: center;
  }
  
  .search-container {
    flex-direction: column;
  }
  
  .search-input {
    min-width: unset;
  }
  
  .minutes-header {
    flex-direction: column;
    gap: var(--spacing-sm);
  }
  
  .results-info {
    flex-direction: column;
    gap: var(--spacing-md);
    text-align: center;
  }
  
  .tag-filters {
    justify-content: center;
  }

  .minutes-actions {
    flex-direction: column;
    gap: var(--spacing-md);
    align-items: stretch;
  }

  .upload-form {
    max-width: 100%;
  }
}

@media (max-width: 480px) {
  .detail-header {
    padding: var(--spacing-xl) 0;
  }
  
  .auth-section,
  .upload-section,
  .search-filter-section {
    padding: var(--spacing-lg);
    margin-bottom: var(--spacing-lg);
  }
  
  .minutes-card {
    padding: var(--spacing-lg);
  }
  
  .container {
    padding: 0 var(--spacing-md);
  }
}

/* æœªãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.login-prompt {
  color: var(--text-secondary);
  text-align: center;
  padding: var(--spacing-xl);
  background: var(--bg-light);
  border-radius: var(--border-radius-button);
  border: 2px dashed var(--border-light);
}

.login-link {
  color: var(--ultla-blue);
  text-decoration: none;
  font-weight: 600;
  transition: all 0.3s var(--animation-smooth);
  padding: var(--spacing-sm) var(--spacing-md);
  border-radius: var(--border-radius-button);
  display: inline-block;
  margin-top: var(--spacing-md);
}

.login-link:hover {
  color: var(--ultla-green);
  background: rgba(0, 184, 148, 0.1);
  transform: translateY(-1px);
}

/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ */
.fade-in {
  animation: fadeIn 0.5s var(--animation-smooth);
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.slide-up {
  animation: slideUp 0.4s var(--animation-smooth);
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
```

  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>ULTLAãƒ©ãƒœ</h1>
      <nav>
        <a href="../../1_news/index.html">ãƒ‹ãƒ¥ãƒ¼ã‚¹</a>
        <a href="../../2_about/index.html">ULTLAã¨ã¯</a>
        <a href="../../3_people/index.html">ULTLAäºº</a>
        <a href="../../4_map/index.html">ãƒãƒƒãƒ—</a>
        <a href="../../5_recipe/index.html">ãƒ¬ã‚·ãƒ”</a>
        <a href="../../6_chat/index.html">ãƒãƒ£ãƒƒãƒˆ</a>
        <a href="../../7_mypage/index.html">è‡ªåˆ†å­¦</a>
        <a href="../index.html">ãƒ©ãƒœ</a>
        <a href="../../9_archive/index.html">ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</a>
        <a href="../../10_contact/index.html">ãŠå•ã„åˆã‚ã›</a>
      </nav>
    </div>
  </header>

  <main>
    <!-- ãƒ—ãƒ­ã‚°ãƒ©ãƒ è©³ç´°ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <section class="detail-header">
      <div class="container">
        <h1 class="detail-title">ã¤ãã‚‹ãƒšãƒ¼ã‚¸</h1>
        <p class="detail-subtitle">ULTLAãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®åˆ¶ä½œãƒ—ãƒ­ã‚»ã‚¹ã‚’å¯è¦–åŒ–ã™ã‚‹å®Ÿé¨“å®¤</p>
        <div class="detail-meta">
          <span class="meta-item">ğŸ“‹ å…¨è­°äº‹éŒ²ç®¡ç†</span>
          <span class="meta-item">ğŸ” æ¨ªæ–­æ¤œç´¢å¯¾å¿œ</span>
          <span class="meta-item">ğŸ·ï¸ ã‚¿ã‚°åˆ†é¡ã‚·ã‚¹ãƒ†ãƒ </span>
          <span class="meta-item">ğŸ¤– AI ã‚¿ã‚¹ã‚¯æŠ½å‡º</span>
          <span class="meta-item">ğŸ“Š ãƒ—ãƒ­ã‚»ã‚¹å¯è¦–åŒ–</span>
        </div>
      </div>
    </section>

```
<div class="container">
  <!-- èªè¨¼çŠ¶æ…‹è¡¨ç¤º -->
  <section class="auth-section fade-in">
    <div id="authStatus">
      <!-- ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ -->
      <div id="loggedInStatus" style="display: none;">
        <div class="login-status">
          <div class="user-info">
            <div class="user-avatar" id="userAvatar">U</div>
            <div>
              <div style="color: var(--ultla-green); font-weight: bold; font-size: 0.9rem;">âœ… ãƒ­ã‚°ã‚¤ãƒ³ä¸­</div>
              <div id="currentUser" style="font-size: 0.9rem; color: var(--text-secondary);"></div>
            </div>
          </div>
          <button id="logoutBtn" class="logout-btn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>
        <div class="action-buttons">
          <button id="showUploadBtn" class="primary-btn">
            ğŸ“ æ–°ã—ã„è­°äº‹éŒ²ã‚’æŠ•ç¨¿
          </button>
          <a href="staff.html" class="secondary-btn">
            ğŸ‘¥ ã¤ãã‚‹ã²ã¨ãƒšãƒ¼ã‚¸
          </a>
        </div>
      </div>
      
      <!-- æœªãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ -->
      <div id="notLoggedInStatus" style="display: none;">
        <div class="login-prompt">
          <h3 style="color: var(--ultla-blue); margin-bottom: var(--spacing-md);">âš ï¸ ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™</h3>
          <p>è­°äº‹éŒ²ã®æŠ•ç¨¿ãƒ»ç·¨é›†ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚</p>
          <a href="../auth-test.html" class="login-link">ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸ â†’</a>
        </div>
      </div>
    </div>
  </section>

  <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
  <div id="messageArea"></div>

  <!-- è­°äº‹éŒ²æŠ•ç¨¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <section id="uploadSection" class="upload-section">
    <div class="section-header">
      <h2 class="section-title">ğŸ“ è­°äº‹éŒ²æŠ•ç¨¿</h2>
      <p class="section-subtitle">ä¼šè­°ã®è¨˜éŒ²ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ã¨å…±æœ‰ã—ã¾ã—ã‚‡ã†</p>
    </div>

    <form class="upload-form" id="uploadForm">
      <div class="form-group">
        <label for="meetingTitle">ä¼šè­°ã‚¿ã‚¤ãƒˆãƒ« <span style="color: var(--ultla-red);">*</span></label>
        <input type="text" id="meetingTitle" required placeholder="ä¾‹ï¼šç¬¬3å› æµ·ã‚¨ãƒªã‚¢ä¼ç”»ä¼šè­°">
      </div>

      <div class="form-group">
        <label for="meetingDate">ä¼šè­°æ—¥ä»˜ <span style="color: var(--ultla-red);">*</span></label>
        <input type="date" id="meetingDate" required>
      </div>

      <div class="form-group">
        <label for="meetingParticipants">å‚åŠ è€…</label>
        <input type="text" id="meetingParticipants" placeholder="ä¾‹ï¼šç”°ä¸­ã€ä½è—¤ã€éŒå€‰å¸‚ãƒ»å±±ç”°æ°">
      </div>

      <div class="form-group">
        <label for="meetingDescription">å†…å®¹ãƒ»æ¦‚è¦ <span style="color: var(--ultla-red);">*</span></label>
        <textarea id="meetingDescription" rows="8" required placeholder="ä¼šè­°ã®å†…å®¹ã‚„ä¸»è¦ãªæ±ºå®šäº‹é …ãªã©
```

ä¾‹ï¼š
TODO: ãƒãƒ©ã‚·ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ç”°ä¸­ã•ã‚“ãŒ9æœˆ15æ—¥ã¾ã§ä½œæˆ
æ‹…å½“: ä½è—¤ã•ã‚“
ç· åˆ‡: æ¥é€±ã¾ã§

ä¼šå ´äºˆç´„ã«ã¤ã„ã¦ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚‹
æ±ºå®šäº‹é …: å‚åŠ è²»ã‚’3000å††ã«è¨­å®š
æ¬¡å›ä¼šè­°: 9æœˆ20æ—¥ 15:00ã€œâ€></textarea>
<div style="display: flex; gap: var(--spacing-sm); margin-top: var(--spacing-sm); align-items: center; flex-wrap: wrap;">
<button type="button" id="previewTasksBtn" class="preview-btn">ğŸ¤– ã‚¿ã‚¹ã‚¯æŠ½å‡ºãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
<small style="color: var(--text-muted);">â€»æŠ•ç¨¿å‰ã«ã©ã‚“ãªã‚¿ã‚¹ã‚¯ãŒæŠ½å‡ºã•ã‚Œã‚‹ã‹ç¢ºèªã§ãã¾ã™</small>
</div>
</div>

```
      <!-- ã‚¿ã‚¹ã‚¯æŠ½å‡ºãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
      <div id="taskPreviewSection" class="task-preview-section">
        <div class="task-preview-title">
          ğŸ¤– æŠ½å‡ºã•ã‚Œã‚‹ã‚¿ã‚¹ã‚¯ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
        </div>
        <div id="taskPreviewContent">
          <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
        </div>
      </div>

      <div class="form-group">
        <label for="meetingTags">ã‚¿ã‚°ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
        <input type="text" id="meetingTags" placeholder="ä¾‹ï¼šæµ·,äº‹å‹™,åºƒå ±,ã‚³ãƒ1">
        <small style="color: var(--text-muted); display: block; margin-top: var(--spacing-xs);">ğŸ’¡ ã‚¨ãƒªã‚¢ï¼ˆæµ·ãƒ»æ£®ï¼‰ã€ã‚«ãƒ†ã‚´ãƒªï¼ˆäº‹å‹™ãƒ»åºƒå ±ï¼‰ã€ãƒ†ãƒ¼ãƒã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆã‚³ãƒ1-4ãƒ»å…¨ä½“ï¼‰ãªã©</small>
      </div>

      <div class="form-group">
        <label for="meetingFile">è­°äº‹éŒ²ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä»»æ„ï¼‰</label>
        <div class="file-drop-zone" id="fileDropZone">
          <div style="font-size: 2rem; margin-bottom: var(--spacing-md);">ğŸ“„</div>
          <p style="font-size: 1.1rem; font-weight: 500; margin-bottom: var(--spacing-sm);">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã‹ã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</p>
          <p style="color: var(--text-muted); font-size: 0.9rem;">å¯¾å¿œå½¢å¼: PDF, Word, Excel, PowerPoint, ãƒ†ã‚­ã‚¹ãƒˆ</p>
        </div>
        <input type="file" id="meetingFile" style="display: none;" accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.md">
        <div class="file-info" id="fileInfo"></div>
      </div>

      <div style="display: flex; gap: var(--spacing-md); flex-wrap: wrap;">
        <button type="submit" class="submit-btn" id="submitBtn" disabled>
          ğŸ“¤ è­°äº‹éŒ²ã‚’æŠ•ç¨¿
        </button>
        <button type="button" id="cancelUploadBtn" class="submit-btn" style="background: var(--text-muted); flex: 0 0 auto; max-width: 200px;">
          ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        </button>
      </div>
    </form>
  </section>

  <!-- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
  <section class="search-filter-section slide-up">
    <div class="search-container">
      <input type="text" class="search-input" placeholder="è­°äº‹éŒ²ã‚’æ¤œç´¢ï¼ˆãƒ•ãƒªãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼‰" id="searchInput">
      <button class="search-btn" onclick="performSearch()">ğŸ” æ¤œç´¢</button>
    </div>
    
    <div class="tag-filters">
      <span class="tag-filter active" data-tag="all">ã™ã¹ã¦</span>
      <span class="tag-filter area" data-tag="æµ·">ğŸŒŠ æµ·</span>
      <span class="tag-filter area" data-tag="æ£®">ğŸŒ² æ£®</span>
      <span class="tag-filter category" data-tag="åºƒå ±">ğŸ“¢ åºƒå ±</span>
      <span class="tag-filter category" data-tag="äº‹å‹™">ğŸ“‹ äº‹å‹™</span>
      <span class="tag-filter theme" data-tag="èº«ä½“">ğŸ§˜ èº«ä½“</span>
      <span class="tag-filter theme" data-tag="éœŠæ€§">âœ¨ éœŠæ€§</span>
      <span class="tag-filter theme" data-tag="ç™ºæ•£">ğŸŒŸ ç™ºæ•£</span>
      <span class="tag-filter theme" data-tag="åæŸ">ğŸ¯ åæŸ</span>
      <span class="tag-filter theme" data-tag="å†…çœ">ğŸ¤” å†…çœ</span>
      <span class="tag-filter program" data-tag="ã‚³ãƒ1">1ï¸âƒ£ ã‚³ãƒ1</span>
      <span class="tag-filter program" data-tag="ã‚³ãƒ2">2ï¸âƒ£ ã‚³ãƒ2</span>
      <span class="tag-filter program" data-tag="ã‚³ãƒ3">3ï¸âƒ£ ã‚³ãƒ3</span>
      <span class="tag-filter program" data-tag="ã‚³ãƒ4">4ï¸âƒ£ ã‚³ãƒ4</span>
      <span class="tag-filter program" data-tag="å…¨ä½“">ğŸŒ å…¨ä½“</span>
    </div>
  </section>

  <!-- æ¤œç´¢çµæœæƒ…å ± -->
  <div class="results-info">
    <span class="results-count" id="resultsCount">è­°äº‹éŒ²ã‚’èª­ã¿è¾¼ã¿ä¸­...</span>
    <select class="sort-select" id="sortSelect" onchange="sortResults()">
      <option value="date-desc">ğŸ“… æ–°ã—ã„é †</option>
      <option value="date-asc">ğŸ“… å¤ã„é †</option>
      <option value="relevance">ğŸ¯ é–¢é€£åº¦é †</option>
    </select>
  </div>

  <!-- è­°äº‹éŒ²ã‚«ãƒ¼ãƒ‰ä¸€è¦§ -->
  <section class="minutes-grid" id="minutesGrid">
    <div class="loading-message">
      <div style="font-size: 2rem; margin-bottom: var(--spacing-md);">â³</div>
      è­°äº‹éŒ²ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...
    </div>
  </section>
</div>
```

  </main>

  <footer>
    <div class="container">
      <small>Â© 2025 ULTLA Fan Community</small>
    </div>
  </footer>

  <!-- Firebaseè¨­å®š -->

  <script type="module" src="../firebase-test.js"></script>

  <!-- è­°äº‹éŒ²ç®¡ç†æ©Ÿèƒ½ - æ”¹ä¿®ç‰ˆ -->

  <script type="module">
    import { db, storage, authReady, auth } from '../firebase-test.js';
    import {
      collection,
      addDoc,
      serverTimestamp,
      query,
      where,
      orderBy,
      onSnapshot,
      doc,
      getDoc,
      setDoc,
      getDocs,
      updateDoc,
      deleteDoc
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
    import {
      ref,
      uploadBytes,
      getDownloadURL
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";
    import {
      signOut
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    // ã‚¿ã‚¹ã‚¯æŠ½å‡ºã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆæ”¹è‰¯ç‰ˆï¼‰
    function extractTasksAndSchedules(content, title = '', meetingDate = new Date()) {
      const result = {
        tasks: [],
        meetings: [],
        decisions: []
      };

      if (!content || typeof content !== 'string') {
        return result;
      }

      const lines = content.split('\n').map(line => line.trim()).filter(line => line.length > 0);
      
      // Level 1: æ˜ç¤ºçš„ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æŠ½å‡º
      result.tasks.push(...extractExplicitTasks(lines, meetingDate));
      result.meetings.push(...extractMeetings(lines, meetingDate));
      result.decisions.push(...extractDecisions(lines));
      
      // Level 2: è‡ªç„¶è¨€èªãƒ‘ã‚¿ãƒ¼ãƒ³ã®æŠ½å‡º
      const remainingText = lines.join(' ');
      result.tasks.push(...extractNaturalLanguageTasks(remainingText, meetingDate));
      
      // é‡è¤‡å‰Šé™¤
      result.tasks = deduplicateTasks(result.tasks);
      result.meetings = deduplicateMeetings(result.meetings);
      result.decisions = deduplicateDecisions(result.decisions);
      
      return result;
    }

    function extractExplicitTasks(lines, meetingDate) {
      const tasks = [];
      const taskPatterns = [
        /^TODO[ï¼š:]\s*(.+)/i,
        /^ã‚„ã‚‹ã“ã¨[ï¼š:]\s*(.+)/i,
        /^ã‚¿ã‚¹ã‚¯[ï¼š:]\s*(.+)/i,
        /^[â¬œâ˜â–¡â–¢]\s*(.+)/,
        /^[-*]\s*\[\s*\]\s*(.+)/,
        /^æ‹…å½“[ï¼š:]\s*(.+)/,
        /^è²¬ä»»è€…[ï¼š:]\s*(.+)/,
        /^ç· åˆ‡[ï¼š:]\s*(.+)/,
        /^æœŸé™[ï¼š:]\s*(.+)/,
        /^æœŸæ—¥[ï¼š:]\s*(.+)/,
        /^ã¾ã§[ï¼š:]\s*(.+)/
      ];

      let currentTask = null;
      
      for (const line of lines) {
        let matched = false;
        
        for (const pattern of taskPatterns) {
          const match = line.match(pattern);
          if (match) {
            const content = match[1].trim();
            
            if (pattern.source.includes('æ‹…å½“') || pattern.source.includes('è²¬ä»»è€…')) {
              if (currentTask) {
                currentTask.assignee = extractAssignee(content);
              }
            } else if (pattern.source.includes('ç· åˆ‡') || pattern.source.includes('æœŸé™') || pattern.source.includes('ã¾ã§')) {
              if (currentTask) {
                currentTask.deadline = extractDeadline(content, meetingDate);
                currentTask.deadlineText = content;
              }
            } else {
              currentTask = {
                id: generateTaskId(),
                content: content,
                type: 'task',
                status: 'todo',
                priority: 'medium',
                assignee: null,
                deadline: null,
                deadlineText: null,
                source: 'explicit',
                createdAt: new Date()
              };
              
              const assigneeMatch = content.match(/(.+?)[ã‚’|ãŒ]\s*([^\s]+?)[ã•ã‚“|æ°|å›]?[ãŒ|ã¯]\s*(.+)/);
              if (assigneeMatch) {
                currentTask.content = assigneeMatch[1].trim() + assigneeMatch[3].trim();
                currentTask.assignee = assigneeMatch[2].trim();
              }
              
              const deadlineMatch = content.match(/(.+?)\s*([0-9]+æœˆ[0-9]+æ—¥|æ¥é€±|ä»Šé€±|ä»Šæœˆ|æ¥æœˆ|[0-9]+æ—¥ã¾ã§)/);
              if (deadlineMatch) {
                currentTask.content = deadlineMatch[1].trim();
                currentTask.deadline = extractDeadline(deadlineMatch[2], meetingDate);
                currentTask.deadlineText = deadlineMatch[2];
              }
              
              tasks.push(currentTask);
            }
            matched = true;
            break;
          }
        }
        
        if (!matched) {
          currentTask = null;
        }
      }
      
      return tasks;
    }

    function extractNaturalLanguageTasks(text, meetingDate) {
      const tasks = [];
      
      const enhancedActionPatterns = [
        /(æ˜æ—¥|ä»Šæ—¥|ä»Šé€±|æ¥é€±|[0-9]+æ—¥|[0-9]+æœˆ[0-9]+æ—¥)ã¾ã§ã«[ã€,]?\s*([^\sã€‚ã€]+?)[ãŒ|ã¯]?\s*([^\sã€‚ã€]+?)[ã‚’|ã«]\s*(å®Ÿè£…|é–‹ç™º|ä½œæˆ|æº–å‚™|ç¢ºèª|èª¿æ•´|æ¤œè¨|å®Ÿæ–½|å¯¾å¿œ|é€£çµ¡)[ã™ã‚‹|ã—ã¾ã™|ã—ã¦ã‚‚ã‚‰ã†]?/g,
        /(ç·Šæ€¥|ä»Šã™ã|æ€¥ã|ASAP)[ã§]?\s*([^\sã€‚ã€]+?)[ã®]?\s*(ç¢ºèª|èª¿æ•´|æ¤œè¨|æº–å‚™|ä½œæˆ|å®Ÿæ–½|å¯¾å¿œ|é€£çµ¡)[ãŒå¿…è¦|ã‚’ã™ã‚‹|ã‚’ã—ã¦ãã ã•ã„]/g,
        /([^\sã€‚ã€]+?)ã‹ã‚‰\s*([^\sã€‚ã€]+?)[ã®]?\s*([^\sã€‚ã€]+?)[ã‚’|ã«|ã«ã¤ã„ã¦]\s*(ãƒ’ã‚¢ãƒªãƒ³ã‚°|ç›¸è«‡|ç¢ºèª|èã)[ã™ã‚‹|ã—ã¦ã‚‚ã‚‰ã†]?/g,
        /([^\sã€‚ã€]+?)[ãŒ|ã¯]\s*([^\sã€‚ã€]+?)[ã‚’|ã«]\s*(å®Ÿè£…|é–‹ç™º|ä½œæˆ|æº–å‚™|ç¢ºèª|èª¿æ•´|æ¤œè¨|å®Ÿæ–½|å¯¾å¿œ|é€£çµ¡)[ã™ã‚‹|ã—ã¾ã™]/g,
        /([^\sã€‚ã€]+?)[ã«|ã¸]\s*(æ¥é€±|ä»Šé€±|æ˜æ—¥|ä»Šæ—¥)?[ã¾ã§ã«]?\s*([^\sã€‚ã€]+?)[ã«ã¤ã„ã¦]?\s*(ç›¸è«‡|ä¾é ¼|ãŠé¡˜ã„|è¦è«‹)[ã™ã‚‹|ã—ã¾ã™]?/g,
        /([^\sã€‚ã€]+?)[ã®]?\s*(ç¢ºèª|èª¿æ•´|æ¤œè¨|æº–å‚™|ä½œæˆ|å®Ÿæ–½|å¯¾å¿œ)[ãŒå¿…è¦]/g
      ];
      
      for (let i = 0; i < enhancedActionPatterns.length; i++) {
        const pattern = enhancedActionPatterns[i];
        let match;
        pattern.lastIndex = 0;
        
        while ((match = pattern.exec(text)) !== null) {
          let assignee = null;
          let content = match[0].trim();
          let deadline = null;
          let deadlineText = null;
          let priority = 'medium';
          
          if (i === 0) {
            deadlineText = match[1];
            deadline = extractDeadline(match[1], meetingDate);
            assignee = extractAssignee(match[2]);
            content = `${match[3]}${match[4]}`;
            
            if (match[1].includes('ä»Šæ—¥') || match[1].includes('æ˜æ—¥')) {
              priority = 'high';
            }
          } else if (i === 1) {
            priority = 'urgent';
            deadlineText = 'ä»Šæ—¥';
            deadline = new Date(meetingDate);
            content = `${match[2]}${match[3]}`;
          } else if (i === 2) {
            assignee = extractAssignee(match[1]);
            content = `${match[2]}${match[3]}ã«ã¤ã„ã¦${match[4]}`;
          } else if (i === 3) {
            assignee = extractAssignee(match[1]);
            content = `${match[2]}ã‚’${match[3]}`;
          } else if (i === 4) {
            assignee = extractAssignee(match[1]);
            if (match[2]) {
              deadlineText = match[2];
              deadline = extractDeadline(match[2], meetingDate);
            }
            content = `${match[3] || ''}ã«ã¤ã„ã¦${match[4]}`;
          } else if (i === 5) {
            content = `${match[1]}${match[2]}`;
            if (content.includes('ç·Šæ€¥') || content.includes('æ€¥ã')) {
              priority = 'urgent';
              deadline = new Date(meetingDate);
              deadlineText = 'ä»Šæ—¥';
            }
          }
          
          if (content.includes('ç·Šæ€¥') || content.includes('æ€¥ã') || content.includes('ä»Šã™ã') || content.includes('ASAP')) {
            priority = 'urgent';
            if (!deadline) {
              deadline = new Date(meetingDate);
              deadlineText = 'ä»Šæ—¥';
            }
          }
          
          const task = {
            id: generateTaskId(),
            content: content,
            type: 'task',
            status: 'todo',
            priority: priority,
            assignee: assignee,
            deadline: deadline,
            deadlineText: deadlineText,
            source: 'natural_language_enhanced',
            createdAt: new Date()
          };
          
          tasks.push(task);
        }
      }
      
      return tasks;
    }

    function extractMeetings(lines, meetingDate) {
      const meetings = [];
      const meetingPatterns = [
        /^æ¬¡å›[ä¼šè­°|ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°|æ‰“ã¡åˆã‚ã›][ï¼š:]\s*(.+)/i,
        /^ä¼šè­°[äºˆå®š|æ—¥ç¨‹][ï¼š:]\s*(.+)/i,
        /^[0-9]+æœˆ[0-9]+æ—¥.*[0-9]+[ï¼š:][0-9]+.*[ä¼šè­°|ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°|æ‰“ã¡åˆã‚ã›]/i
      ];
      
      for (const line of lines) {
        for (const pattern of meetingPatterns) {
          const match = line.match(pattern);
          if (match) {
            const meeting = {
              id: generateTaskId(),
              title: 'ä¼šè­°äºˆå®š',
              content: match[1] || match[0],
              type: 'meeting',
              date: extractMeetingDate(match[1] || match[0], meetingDate),
              source: 'explicit',
              createdAt: new Date()
            };
            meetings.push(meeting);
          }
        }
      }
      
      return meetings;
    }

    function extractDecisions(lines) {
      const decisions = [];
      const decisionPatterns = [
        /^æ±ºå®š[äº‹é …]?[ï¼š:]\s*(.+)/i,
        /^æ±ºã¾ã£ãŸã“ã¨[ï¼š:]\s*(.+)/i,
        /^åˆæ„[äº‹é …]?[ï¼š:]\s*(.+)/i
      ];
      
      for (const line of lines) {
        for (const pattern of decisionPatterns) {
          const match = line.match(pattern);
          if (match) {
            const decision = {
              id: generateTaskId(),
              content: match[1].trim(),
              type: 'decision',
              createdAt: new Date()
            };
            decisions.push(decision);
          }
        }
      }
      
      return decisions;
    }

    function extractAssignee(text) {
      const cleaned = text.replace(/ã•ã‚“|æ°|å›|æ§˜/g, '').trim();
      const names = cleaned.split(/[ã€,ãƒ»]/);
      return names[0].trim();
    }

    function extractDeadline(text, baseDate) {
      const now = new Date(baseDate);
      
      const dateMatch = text.match(/([0-9]+)æœˆ([0-9]+)æ—¥/);
      if (dateMatch) {
        const month = parseInt(dateMatch[1]);
        const day = parseInt(dateMatch[2]);
        const year = month >= now.getMonth() + 1 ? now.getFullYear() : now.getFullYear() + 1;
        return new Date(year, month - 1, day);
      }
      
      if (text.includes('ä»Šæ—¥')) {
        return new Date(now);
      } else if (text.includes('æ˜æ—¥')) {
        const tomorrow = new Date(now);
        tomorrow.setDate(tomorrow.getDate() + 1);
        return tomorrow;
      } else if (text.includes('ä»Šé€±')) {
        const endOfWeek = new Date(now);
        endOfWeek.setDate(endOfWeek.getDate() + (7 - endOfWeek.getDay()));
        return endOfWeek;
      } else if (text.includes('æ¥é€±')) {
        const nextWeek = new Date(now);
        nextWeek.setDate(nextWeek.getDate() + 7);
        return nextWeek;
      } else if (text.includes('ä»Šæœˆ')) {
        const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0);
        return endOfMonth;
      } else if (text.includes('æ¥æœˆ')) {
        const nextMonth = new Date(now.getFullYear(), now.getMonth() + 2, 0);
        return nextMonth;
      }
      
      return null;
    }

    function extractMeetingDate(text, baseDate) {
      const dateMatch = text.match(/([0-9]+)æœˆ([0-9]+)æ—¥/);
      if (dateMatch) {
        const month = parseInt(dateMatch[1]);
        const day = parseInt(dateMatch[2]);
        const year = month >= baseDate.getMonth() + 1 ? baseDate.getFullYear() : baseDate.getFullYear() + 1;
        
        const timeMatch = text.match(/([0-9]+)[ï¼š:]([0-9]+)/);
        if (timeMatch) {
          const hour = parseInt(timeMatch[1]);
          const minute = parseInt(timeMatch[2]);
          return new Date(year, month - 1, day, hour, minute);
        }
        
        return new Date(year, month - 1, day);
      }
      
      return null;
    }

    function deduplicateTasks(tasks) {
      const seen = new Set();
      return tasks.filter(task => {
        const key = `${task.content}_${task.assignee || 'none'}`;
        if (seen.has(key)) {
          return false;
        }
        seen.add(key);
        return true;
      });
    }

    function deduplicateMeetings(meetings) {
      const seen = new Set();
      return meetings.filter(meeting => {
        const key = `${meeting.content}_${meeting.date?.getTime() || 'none'}`;
        if (seen.has(key)) {
          return false;
        }
        seen.add(key);
        return true;
      });
    }

    function deduplicateDecisions(decisions) {
      const seen = new Set();
      return decisions.filter(decision => {
        if (seen.has(decision.content)) {
          return false;
        }
        seen.add(decision.content);
        return true;
      });
    }

    function generateTaskId() {
      return 'task_' + Date.now() + '_' + Math.random().toString(36).substring(2, 9);
    }

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
    let currentUID = null;
    let userProfile = null;
    let selectedFile = null;
    let allMeetingRecords = [];
    let extractedData = null;

    // DOMè¦ç´ 
    const loggedInStatus = document.getElementById('loggedInStatus');
    const notLoggedInStatus = document.getElementById('notLoggedInStatus');
    const currentUser = document.getElementById('currentUser');
    const userAvatar = document.getElementById('userAvatar');
    const logoutBtn = document.getElementById('logoutBtn');
    const showUploadBtn = document.getElementById('showUploadBtn');
    const uploadSection = document.getElementById('uploadSection');
    const cancelUploadBtn = document.getElementById('cancelUploadBtn');
    const messageArea = document.getElementById('messageArea');
    const minutesGrid = document.getElementById('minutesGrid');
    const resultsCount = document.getElementById('resultsCount');
    const previewTasksBtn = document.getElementById('previewTasksBtn');
    const taskPreviewSection = document.getElementById('taskPreviewSection');
    const taskPreviewContent = document.getElementById('taskPreviewContent');

    // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—é–¢æ•°
    function escapeHTML(str) {
      if (typeof str !== 'string') return '';
      return str.replace(/[&<>"']/g, function (match) {
        return {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;',
        }[match];
      });
    }

    // çµæœä»¶æ•°æ›´æ–°
    function updateResultsCount(count) {
      if (resultsCount) {
        resultsCount.textContent = `${count}ä»¶ã®è­°äº‹éŒ²ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`;
      }
    }

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—
    async function getUserProfile(uid) {
      if (!uid) return null;
      try {
        const profileRef = doc(db, "userProfiles", uid);
        const profileSnap = await getDoc(profileRef);
        return profileSnap.exists() ? profileSnap.data() : null;
      } catch (error) {
        console.error("ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—ã‚¨ãƒ©ãƒ¼:", error);
        return null;
      }
    }

    // èªè¨¼çŠ¶æ…‹è¡¨ç¤ºæ›´æ–°
    async function updateAuthDisplay(user) {
      if (user) {
        currentUID = user.uid;
        userProfile = await getUserProfile(user.uid);
        
        let displayText;
        let avatarText = 'U';
        
        if (userProfile && userProfile.username) {
          displayText = `${userProfile.username}ã•ã‚“`;
          avatarText = userProfile.username.charAt(0).toUpperCase();
        } else {
          const email = user.email || `åŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼ (${user.uid.substring(0, 8)}...)`;
          displayText = email;
          avatarText = user.email ? user.email.charAt(0).toUpperCase() : 'A';
        }
        
        const authMethod = user.isAnonymous ? 'åŒ¿å' : (user.providerData[0]?.providerId === 'google.com' ? 'Google' : 'ãƒ¡ãƒ¼ãƒ«');
        currentUser.innerHTML = `${displayText} <small style="color: var(--text-muted);">(${authMethod}èªè¨¼)</small>`;
        userAvatar.textContent = avatarText;
        
        loggedInStatus.style.display = 'block';
        notLoggedInStatus.style.display = 'none';
        
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ
        loggedInStatus.classList.add('fade-in');
      } else {
        currentUID = null;
        userProfile = null;
        loggedInStatus.style.display = 'none';
        notLoggedInStatus.style.display = 'block';
        notLoggedInStatus.classList.add('fade-in');
      }
    }

    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºï¼ˆæ”¹è‰¯ç‰ˆï¼‰
    function showMessage(message, type = 'info') {
      const messageDiv = document.createElement('div');
      messageDiv.className = `${type}-message fade-in`;
      messageDiv.textContent = message;
      messageArea.innerHTML = '';
      messageArea.appendChild(messageDiv);
      
      // è‡ªå‹•æ¶ˆå»ã‚¿ã‚¤ãƒãƒ¼
      setTimeout(() => {
        messageDiv.style.opacity = '0';
        messageDiv.style.transform = 'translateY(-10px)';
        setTimeout(() => {
          messageDiv.remove();
        }, 300);
      }, 5000);
    }

    // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
    async function handleLogout() {
      try {
        await signOut(auth);
        showMessage('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ', 'success');
        setTimeout(() => {
          window.location.href = '../auth-test.html';
        }, 1000);
      } catch (error) {
        console.error("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼:", error);
        showMessage('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'error');
      }
    }

    // è­°äº‹éŒ²ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰è¡¨ç¤º/éè¡¨ç¤º
    function toggleUploadSection() {
      if (uploadSection.classList.contains('show')) {
        uploadSection.classList.remove('show');
        showUploadBtn.innerHTML = 'ğŸ“ æ–°ã—ã„è­°äº‹éŒ²ã‚’æŠ•ç¨¿';
        taskPreviewSection.classList.remove('show');
      } else {
        uploadSection.classList.add('show');
        uploadSection.classList.add('slide-up');
        showUploadBtn.innerHTML = 'âŒ æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‰ã˜ã‚‹';
        document.getElementById('meetingDate').value = new Date().toISOString().split('T')[0];
      }
    }

    // ã‚¿ã‚¹ã‚¯æŠ½å‡ºãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆæ”¹è‰¯ç‰ˆï¼‰
    function previewTasks() {
      const title = document.getElementById('meetingTitle').value.trim();
      const content = document.getElementById('meetingDescription').value.trim();
      const dateValue = document.getElementById('meetingDate').value;
      const meetingDate = dateValue ? new Date(dateValue) : new Date();

      if (!content) {
        showMessage('å†…å®¹ãƒ»æ¦‚è¦ã‚’å…¥åŠ›ã—ã¦ã‹ã‚‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ãã ã•ã„', 'error');
        return;
      }

      extractedData = extractTasksAndSchedules(content, title, meetingDate);

      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
      let previewHTML = '';
      
      if (extractedData.tasks.length > 0) {
        previewHTML += `<div style="margin-bottom: 1.5rem;">
          <h4 style="color: var(--ultla-green); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
            ğŸ“‹ ã‚¿ã‚¹ã‚¯ (${extractedData.tasks.length}ä»¶)
          </h4>`;
        extractedData.tasks.forEach(task => {
          const priorityEmoji = task.priority === 'urgent' ? 'ğŸ”¥' : task.priority === 'high' ? 'âš¡' : 'ğŸ“';
          previewHTML += `
            <div class="preview-item task-item">
              <div class="item-content">${priorityEmoji} ${escapeHTML(task.content)}</div>
              <div class="item-meta">
                ${task.assignee ? `ğŸ‘¤ æ‹…å½“: ${escapeHTML(task.assignee)} | ` : ''}
                ${task.deadline ? `ğŸ“… æœŸé™: ${task.deadline.toLocaleDateString('ja-JP')} | ` : ''}
                ğŸ” æŠ½å‡ºæ–¹æ³•: ${task.source === 'explicit' ? 'æ˜ç¤ºçš„ãƒ‘ã‚¿ãƒ¼ãƒ³' : 'è‡ªç„¶è¨€èªè§£æ'}
                ${task.priority !== 'medium' ? ` | âš ï¸ å„ªå…ˆåº¦: ${task.priority}` : ''}
              </div>
            </div>
          `;
        });
        previewHTML += '</div>';
      }

      if (extractedData.meetings.length > 0) {
        previewHTML += `<div style="margin-bottom: 1.5rem;">
          <h4 style="color: var(--ultla-blue); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
            ğŸ“… ä¼šè­°ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« (${extractedData.meetings.length}ä»¶)
          </h4>`;
        extractedData.meetings.forEach(meeting => {
          previewHTML += `
            <div class="preview-item meeting-item">
              <div class="item-content">ğŸ—“ï¸ ${escapeHTML(meeting.content)}</div>
              <div class="item-meta">
                ${meeting.date ? `ğŸ“… æ—¥æ™‚: ${meeting.date.toLocaleString('ja-JP')}` : 'âš ï¸ æ—¥æ™‚æœªè¨­å®š'}
              </div>
            </div>
          `;
        });
        previewHTML += '</div>';
      }

      if (extractedData.decisions.length > 0) {
        previewHTML += `<div style="margin-bottom: 1.5rem;">
          <h4 style="color: var(--ultla-red); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
            âœ… æ±ºå®šäº‹é … (${extractedData.decisions.length}ä»¶)
          </h4>`;
        extractedData.decisions.forEach(decision => {
          previewHTML += `
            <div class="preview-item decision-item">
              <div class="item-content">ğŸ“‹ ${escapeHTML(decision.content)}</div>
            </div>
          `;
        });
        previewHTML += '</div>';
      }

      if (previewHTML === '') {
        previewHTML = `
          <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
            <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ¤”</div>
            <p>ã‚¿ã‚¹ã‚¯ã‚„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚</p>
            <p style="font-size: 0.9rem; margin-top: 1rem;">
              ğŸ’¡ ãƒ’ãƒ³ãƒˆ: ã€ŒTODO:ã€ã€Œæ‹…å½“:ã€ã€Œç· åˆ‡:ã€ã€Œæ±ºå®šäº‹é …:ã€ãªã©ã®æ˜ç¤ºçš„ãªå½¢å¼ã§è¨˜è¿°ã™ã‚‹ã¨æŠ½å‡ºç²¾åº¦ãŒå‘ä¸Šã—ã¾ã™ã€‚
            </p>
          </div>
        `;
      }

      taskPreviewContent.innerHTML = previewHTML;
      taskPreviewSection.classList.add('show');

      showMessage('ã‚¿ã‚¹ã‚¯æŠ½å‡ºãŒå®Œäº†ã—ã¾ã—ãŸï¼æŠ•ç¨¿å‰ã«å†…å®¹ã‚’ã”ç¢ºèªãã ã•ã„ã€‚', 'success');
    }

    // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå‡¦ç†ï¼ˆæ”¹è‰¯ç‰ˆï¼‰
    const fileDropZone = document.getElementById('fileDropZone');
    const meetingFile = document.getElementById('meetingFile');
    const fileInfo = document.getElementById('fileInfo');
    const submitBtn = document.getElementById('submitBtn');

    fileDropZone.addEventListener('click', () => meetingFile.click());

    fileDropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      fileDropZone.classList.add('dragover');
    });

    fileDropZone.addEventListener('dragleave', () => {
      fileDropZone.classList.remove('dragover');
    });

    fileDropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      fileDropZone.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        handleFileSelect(files[0]);
      }
    });

    meetingFile.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        handleFileSelect(e.target.files[0]);
      }
    });

    function handleFileSelect(file) {
      selectedFile = file;
      fileInfo.style.display = 'block';
      fileInfo.innerHTML = `
        <div style="display: flex; align-items: center; gap: 1rem;">
          <div style="font-size: 2rem;">ğŸ“</div>
          <div>
            <h4 style="margin: 0; color: var(--ultla-green);">âœ… ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¾ã—ãŸ</h4>
            <p style="margin: 0.5rem 0 0 0;"><strong>åå‰:</strong> ${file.name}</p>
            <p style="margin: 0.25rem 0;"><strong>ã‚µã‚¤ã‚º:</strong> ${(file.size / 1024 / 1024).toFixed(2)} MB</p>
            <p style="margin: 0.25rem 0 0 0;"><strong>å½¢å¼:</strong> ${file.type || 'ä¸æ˜'}</p>
          </div>
        </div>
      `;
      updateSubmitButton();
    }

    function updateSubmitButton() {
      const title = document.getElementById('meetingTitle').value.trim();
      const date = document.getElementById('meetingDate').value;
      const description = document.getElementById('meetingDescription').value.trim();
      
      if (title && date && description) {
        submitBtn.disabled = false;
        submitBtn.style.background = 'var(--primary-gradient)';
      } else {
        submitBtn.disabled = true;
        submitBtn.style.background = 'var(--text-muted)';
      }
    }

    // ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ç›£è¦–
    document.getElementById('meetingTitle').addEventListener('input', updateSubmitButton);
    document.getElementById('meetingDate').addEventListener('input', updateSubmitButton);
    document.getElementById('meetingDescription').addEventListener('input', updateSubmitButton);

    // è­°äº‹éŒ²æŠ•ç¨¿å‡¦ç†ï¼ˆæ”¹è‰¯ç‰ˆï¼‰
    document.getElementById('uploadForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (!currentUID) {
        showMessage('ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™', 'error');
        return;
      }

      const formData = {
        title: document.getElementById('meetingTitle').value.trim(),
        meetingDate: new Date(document.getElementById('meetingDate').value),
        participants: document.getElementById('meetingParticipants').value.trim() || '',
        description: document.getElementById('meetingDescription').value.trim(),
        tags: document.getElementById('meetingTags').value.split(',').map(tag => tag.trim()).filter(tag => tag !== '')
      };

      submitBtn.disabled = true;
      submitBtn.innerHTML = 'ğŸ“¤ æŠ•ç¨¿ä¸­...';
      submitBtn.style.background = 'var(--text-muted)';

      try {
        let fileUrl = '';
        let fileName = '';
        let fileSize = 0;
        let fileType = '';

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
        if (selectedFile) {
          showMessage('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...', 'info');
          const fileStorageName = `meeting_records/${currentUID}_${Date.now()}_${selectedFile.name}`;
          const fileRef = ref(storage, fileStorageName);
          const snapshot = await uploadBytes(fileRef, selectedFile);
          fileUrl = await getDownloadURL(snapshot.ref);
          fileName = selectedFile.name;
          fileSize = selectedFile.size;
          fileType = selectedFile.type;
        }

        // ã‚¿ã‚¹ã‚¯æŠ½å‡ºï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ç”¨ã€ãªã‘ã‚Œã°æ–°è¦æŠ½å‡ºï¼‰
        let extractedTasks = extractedData;
        if (!extractedTasks) {
          extractedTasks = extractTasksAndSchedules(formData.description, formData.title, formData.meetingDate);
        }

        // Firestoreã«ä¿å­˜
        const recordData = {
          uid: currentUID,
          uploaderName: userProfile ? userProfile.displayName || userProfile.username : 'åŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼',
          title: formData.title,
          meetingDate: formData.meetingDate,
          participants: formData.participants,
          description: formData.description,
          tags: formData.tags,
          fileUrl,
          fileName,
          fileSize,
          fileType,
          project: 'ULTLA2025',
          status: 'published',
          // æŠ½å‡ºã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æƒ…å ±ã‚’è¿½åŠ 
          extractedTasks: extractedTasks.tasks,
          extractedMeetings: extractedTasks.meetings,
          extractedDecisions: extractedTasks.decisions,
          taskExtractionVersion: '2.0', // æ”¹è‰¯ç‰ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³
          createdAt: serverTimestamp(),
          updatedAt: serverTimestamp()
        };

        const docRef = await addDoc(collection(db, "meetingRecords"), recordData);
        
        // æŠ½å‡ºã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã‚’å€‹åˆ¥ã«projectTasksã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«ä¿å­˜
        if (extractedTasks.tasks.length > 0) {
          for (const task of extractedTasks.tasks) {
            const taskData = {
              ...task,
              meetingRecordId: docRef.id,
              meetingTitle: formData.title,
              uid: currentUID,
              project: 'ULTLA2025',
              createdAt: serverTimestamp()
            };
            await addDoc(collection(db, "projectTasks"), taskData);
          }
        }

        // ä¼šè­°æƒ…å ±ã‚‚ä¿å­˜
        if (extractedTasks.meetings.length > 0) {
          for (const meeting of extractedTasks.meetings) {
            const meetingData = {
              ...meeting,
              meetingRecordId: docRef.id,
              uid: currentUID,
              project: 'ULTLA2025',
              createdAt: serverTimestamp()
            };
            await addDoc(collection(db, "projectSchedules"), meetingData);
          }
        }
        
        showMessage(`ğŸ‰ è­°äº‹éŒ²ãŒæŠ•ç¨¿ã•ã‚Œã¾ã—ãŸï¼ï¼ˆã‚¿ã‚¹ã‚¯${extractedTasks.tasks.length}ä»¶ã€ä¼šè­°${extractedTasks.meetings.length}ä»¶ã€æ±ºå®šäº‹é …${extractedTasks.decisions.length}ä»¶ã‚’æŠ½å‡ºï¼‰`, 'success');
        
        // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        document.getElementById('uploadForm').reset();
        selectedFile = null;
        extractedData = null;
        fileInfo.style.display = 'none';
        taskPreviewSection.classList.remove('show');
        toggleUploadSection();
        updateSubmitButton();

      } catch (error) {
        console.error('æŠ•ç¨¿ã‚¨ãƒ©ãƒ¼:', error);
        showMessage('æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'error');
      } finally {
        submitBtn.innerHTML = 'ğŸ“¤ è­°äº‹éŒ²ã‚’æŠ•ç¨¿';
        submitBtn.disabled = false;
        submitBtn.style.background = 'var(--primary-gradient)';
      }
    });

    // è­°äº‹éŒ²ä¸€è¦§è¡¨ç¤ºï¼ˆæ”¹è‰¯ç‰ˆï¼‰
    function displayMeetingRecords() {
      try {
        const recordsRef = collection(db, "meetingRecords");
        
        onSnapshot(recordsRef, (querySnapshot) => {
          console.log('è­°äº‹éŒ²ãƒ‡ãƒ¼ã‚¿å–å¾—:', querySnapshot.size);
          allMeetingRecords = [];
          
          querySnapshot.forEach((doc) => {
            const record = doc.data();
            allMeetingRecords.push({
              id: doc.id,
              ...record
            });
          });
          
          // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
          const filteredRecords = allMeetingRecords.filter(record => 
            record.project === 'ULTLA2025'
          );
          
          // æ—¥ä»˜ã‚½ãƒ¼ãƒˆ
          filteredRecords.sort((a, b) => {
            const dateA = a.meetingDate?.toDate ? a.meetingDate.toDate() : new Date(a.meetingDate);
            const dateB = b.meetingDate?.toDate ? b.meetingDate.toDate() : new Date(b.meetingDate);
            return dateB - dateA;
          });
          
          // è¡¨ç¤ºå‡¦ç†
          renderMeetingRecords(filteredRecords);
          updateResultsCount(filteredRecords.length);
          
        }, (error) => {
          console.error("è­°äº‹éŒ²èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:", error);
          minutesGrid.innerHTML = `
            <div class="error-message">
              <h4>âŒ è­°äº‹éŒ²ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</h4>
              <p>ã‚¨ãƒ©ãƒ¼: ${error.message}</p>
              <button onclick="window.location.reload()" style="margin-top: 1rem; padding: 8px 16px; background: var(--ultla-blue); color: white; border: none; border-radius: var(--border-radius-button); cursor: pointer;">
                ğŸ”„ ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿
              </button>
            </div>
          `;
        });
        
      } catch (error) {
        console.error('ã‚¯ã‚¨ãƒªä½œæˆã‚¨ãƒ©ãƒ¼:', error);
        minutesGrid.innerHTML = `
          <div class="error-message">
            <h4>âŒ ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h4>
            <p>ã‚¯ã‚¨ãƒªã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}</p>
          </div>
        `;
      }
    }

    // è­°äº‹éŒ²ã‚«ãƒ¼ãƒ‰æç”»ï¼ˆæ”¹è‰¯ç‰ˆï¼‰
    function renderMeetingRecords(records) {
      if (records.length === 0) {
        minutesGrid.innerHTML = `
          <div class="loading-message">
            <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“</div>
            <h3>è­°äº‹éŒ²ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</h3>
            <p>æœ€åˆã®è­°äº‹éŒ²ã‚’æŠ•ç¨¿ã—ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹å§‹ã—ã¾ã—ã‚‡ã†ï¼</p>
          </div>
        `;
        return;
      }

      minutesGrid.innerHTML = '';
      
      records.forEach((record, index) => {
        try {
          const cardElement = createMeetingRecordCard(record);
          cardElement.style.animationDelay = `${index * 0.1}s`;
          cardElement.classList.add('slide-up');
          minutesGrid.appendChild(cardElement);
        } catch (error) {
          console.error(`ã‚«ãƒ¼ãƒ‰ä½œæˆã‚¨ãƒ©ãƒ¼ (${record.title}):`, error);
        }
      });
    }

    // è­°äº‹éŒ²ã‚«ãƒ¼ãƒ‰ä½œæˆï¼ˆæ”¹è‰¯ç‰ˆï¼‰
    function createMeetingRecordCard(record) {
      const element = document.createElement('article');
      element.className = 'minutes-card';
      element.setAttribute('data-tags', record.tags ? record.tags.join(',') : '');

      let meetingDate;
      try {
        meetingDate = record.meetingDate ? 
          (record.meetingDate.toDate ? record.meetingDate.toDate() : new Date(record.meetingDate)) :
          new Date();
      } catch (dateError) {
        console.error('æ—¥ä»˜å¤‰æ›ã‚¨ãƒ©ãƒ¼:', dateError);
        meetingDate = new Date();
      }

      const isOwner = record.uid === currentUID;
      
      // æŠ½å‡ºã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æƒ…å ±ã®è¡¨ç¤ºæº–å‚™
      let extractedContentHTML = '';
      const totalTasks = (record.extractedTasks || []).length;
      const totalMeetings = (record.extractedMeetings || []).length;
      const totalDecisions = (record.extractedDecisions || []).length;

      if (totalTasks > 0 || totalMeetings > 0 || totalDecisions > 0) {
        extractedContentHTML = `
          <div class="extracted-tasks">
            <div class="extracted-tasks-title">
              ğŸ¤– AIæŠ½å‡ºçµæœ (ã‚¿ã‚¹ã‚¯${totalTasks}ä»¶ãƒ»ä¼šè­°${totalMeetings}ä»¶ãƒ»æ±ºå®š${totalDecisions}ä»¶)
            </div>
        `;

        // ã‚¿ã‚¹ã‚¯ã®è¡¨ç¤ºï¼ˆæœ€å¤§3ä»¶ï¼‰
        if (record.extractedTasks && record.extractedTasks.length > 0) {
          record.extractedTasks.slice(0, 3).forEach(task => {
            const priorityEmoji = task.priority === 'urgent' ? 'ğŸ”¥' : task.priority === 'high' ? 'âš¡' : 'ğŸ“';
            extractedContentHTML += `
              <div class="extracted-task-item">
                ${priorityEmoji} ${escapeHTML(task.content)}
                ${task.assignee ? ` (ğŸ‘¤ ${escapeHTML(task.assignee)})` : ''}
                ${task.deadline ? ` (ğŸ“… ${new Date(task.deadline.seconds * 1000).toLocaleDateString('ja-JP')})` : ''}
              </div>
            `;
          });
          if (record.extractedTasks.length > 3) {
            extractedContentHTML += `<div class="extracted-task-item" style="color: var(--text-muted); font-style: italic;">...ä»–${record.extractedTasks.length - 3}ä»¶ã®ã‚¿ã‚¹ã‚¯</div>`;
          }
        }

        // ä¼šè­°ã®è¡¨ç¤ºï¼ˆæœ€å¤§2ä»¶ï¼‰
        if (record.extractedMeetings && record.extractedMeetings.length > 0) {
          record.extractedMeetings.slice(0, 2).forEach(meeting => {
            extractedContentHTML += `
              <div class="extracted-task-item">
                ğŸ“… ${escapeHTML(meeting.content)}
                ${meeting.date ? ` (${new Date(meeting.date.seconds * 1000).toLocaleString('ja-JP')})` : ''}
              </div>
            `;
          });
          if (record.extractedMeetings.length > 2) {
            extractedContentHTML += `<div class="extracted-task-item" style="color: var(--text-muted); font-style: italic;">...ä»–${record.extractedMeetings.length - 2}ä»¶ã®ä¼šè­°</div>`;
          }
        }

        // æ±ºå®šäº‹é …ã®è¡¨ç¤ºï¼ˆæœ€å¤§2ä»¶ï¼‰
        if (record.extractedDecisions && record.extractedDecisions.length > 0) {
          record.extractedDecisions.slice(0, 2).forEach(decision => {
            extractedContentHTML += `
              <div class="extracted-task-item">
                âœ… ${escapeHTML(decision.content)}
              </div>
            `;
          });
          if (record.extractedDecisions.length > 2) {
            extractedContentHTML += `<div class="extracted-task-item" style="color: var(--text-muted); font-style: italic;">...ä»–${record.extractedDecisions.length - 2}ä»¶ã®æ±ºå®šäº‹é …</div>`;
          }
        }

        extractedContentHTML += '</div>';
      }

      element.innerHTML = `
        <div class="minutes-header">
          <div>
            <h3 class="minutes-title">${escapeHTML(record.title || 'ç„¡é¡Œ')}</h3>
            ${record.participants ? `<p class="minutes-participants">ğŸ‘¥ å‚åŠ è€…: ${escapeHTML(record.participants)}</p>` : ''}
          </div>
          <span class="minutes-date">ğŸ“… ${meetingDate.toLocaleDateString('ja-JP')}</span>
        </div>
        
        <div class="minutes-content">
          ${escapeHTML((record.description || 'å†…å®¹ãªã—').substring(0, 200))}${record.description && record.description.length > 200 ? '...' : ''}
        </div>
        
        ${record.tags && record.tags.length > 0 ? `
          <div class="minutes-tags">
            ${record.tags.map(tag => {
              let tagClass = 'tag-theme';
              if (['æµ·', 'æ£®'].includes(tag)) tagClass = 'tag-area';
              else if (['äº‹å‹™', 'åºƒå ±'].includes(tag)) tagClass = 'tag-category';
              else if (['ã‚³ãƒ1', 'ã‚³ãƒ2', 'ã‚³ãƒ3', 'ã‚³ãƒ4', 'å…¨ä½“'].includes(tag)) tagClass = 'tag-program';
              
              return `<span class="minutes-tag ${tagClass}">${escapeHTML(tag)}</span>`;
            }).join('')}
          </div>
        ` : ''}
        
        ${extractedContentHTML}
        
        <div class="minutes-actions">
          <div>
            ${record.fileUrl ? `<a href="${record.fileUrl}" target="_blank" class="view-detail-btn">ğŸ“„ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã</a>` : ''}
          </div>
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <small style="color: var(--text-muted);">ğŸ‘¤ ${escapeHTML(record.uploaderName || 'ä¸æ˜')}</small>
            ${isOwner ? `
              <button class="action-btn edit-btn" onclick="editRecord('${record.id}')">âœï¸ ç·¨é›†</button>
              <button class="action-btn delete-btn" onclick="deleteRecord('${record.id}')">ğŸ—‘ï¸ å‰Šé™¤</button>
            ` : ''}
          </div>
        </div>
      `;

      return element;
    }

    // æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ï¼ˆæ”¹è‰¯ç‰ˆï¼‰
    window.performSearch = function() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      
      if (!searchTerm.trim()) {
        renderMeetingRecords(allMeetingRecords.filter(record => record.project === 'ULTLA2025'));
        updateResultsCount(allMeetingRecords.filter(record => record.project === 'ULTLA2025').length);
        return;
      }

      const filteredRecords = allMeetingRecords.filter(record => {
        if (record.project !== 'ULTLA2025') return false;
        
        // æ¤œç´¢å¯¾è±¡ã‚’æ‹¡å¼µ
        const searchableText = [
          record.title,
          record.description,
          record.participants || '',
          (record.tags || []).join(' '),
          // æŠ½å‡ºã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã‚‚æ¤œç´¢å¯¾è±¡ã«å«ã‚ã‚‹
          (record.extractedTasks || []).map(task => task.content).join(' '),
          (record.extractedMeetings || []).map(meeting => meeting.content).join(' '),
          (record.extractedDecisions || []).map(decision => decision.content).join(' ')
        ].join(' ').toLowerCase();
        
        return searchableText.includes(searchTerm);
      });

      renderMeetingRecords(filteredRecords);
      updateResultsCount(filteredRecords.length);
      
      if (filteredRecords.length === 0) {
        showMessage(`"${searchTerm}" ã«è©²å½“ã™ã‚‹è­°äº‹éŒ²ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ`, 'info');
      }
    };

    // ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆæ”¹è‰¯ç‰ˆï¼‰
    function filterByTag(tag) {
      // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ã‚°ã®è¦–è¦šçš„æ›´æ–°
      document.querySelectorAll('.tag-filter').forEach(t => t.classList.remove('active'));
      document.querySelector(`.tag-filter[data-tag="${tag}"]`).classList.add('active');
      
      if (tag === 'all') {
        const filteredRecords = allMeetingRecords.filter(record => record.project === 'ULTLA2025');
        renderMeetingRecords(filteredRecords);
        updateResultsCount(filteredRecords.length);
        return;
      }

      const filteredRecords = allMeetingRecords.filter(record => {
        return record.project === 'ULTLA2025' && record.tags && record.tags.includes(tag);
      });

      renderMeetingRecords(filteredRecords);
      updateResultsCount(filteredRecords.length);
      
      if (filteredRecords.length === 0) {
        showMessage(`"${tag}" ã‚¿ã‚°ã®è­°äº‹éŒ²ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ`, 'info');
      }
    }

    // ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
    document.querySelectorAll('.tag-filter').forEach(tag => {
      tag.addEventListener('click', function() {
        const selectedTag = this.dataset.tag;
        filterByTag(selectedTag);
      });
    });

    // ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ï¼ˆæ”¹è‰¯ç‰ˆï¼‰
    window.sortResults = function() {
      const sortBy = document.getElementById('sortSelect').value;
      const currentRecords = [...allMeetingRecords].filter(record => record.project === 'ULTLA2025');
      
      currentRecords.sort((a, b) => {
        if (sortBy === 'date-desc') {
          const dateA = a.meetingDate?.toDate ? a.meetingDate.toDate() : new Date(a.meetingDate);
          const dateB = b.meetingDate?.toDate ? b.meetingDate.toDate() : new Date(b.meetingDate);
          return dateB - dateA;
        } else if (sortBy === 'date-asc') {
          const dateA = a.meetingDate?.toDate ? a.meetingDate.toDate() : new Date(a.meetingDate);
          const dateB = b.meetingDate?.toDate ? b.meetingDate.toDate() : new Date(b.meetingDate);
          return dateA - dateB;
        } else if (sortBy === 'relevance') {
          // æŠ½å‡ºã•ã‚ŒãŸã‚¿ã‚¹ã‚¯æ•°ã§é–¢é€£åº¦ã‚’ã‚½ãƒ¼ãƒˆ
          const scoreA = (a.extractedTasks || []).length + (a.extractedMeetings || []).length + (a.extractedDecisions || []).length;
          const scoreB = (b.extractedTasks || []).length + (b.extractedMeetings || []).length + (b.extractedDecisions || []).length;
          return scoreB - scoreA;
        }
        return 0;
      });
      
      renderMeetingRecords(currentRecords);
    };

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ï¼ˆç·¨é›†ãƒ»å‰Šé™¤ç”¨ï¼‰
    window.editRecord = function(recordId) {
      showMessage('ç·¨é›†æ©Ÿèƒ½ã¯ç¾åœ¨é–‹ç™ºä¸­ã§ã™ã€‚è¿‘æ—¥ä¸­ã«å®Ÿè£…äºˆå®šã§ã™ã€‚', 'info');
    };

    window.deleteRecord = function(recordId) {
      if (confirm('âŒ ã“ã®è­°äº‹éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nâš ï¸ ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚\nğŸ“‹ æŠ½å‡ºã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã‚„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚‚åŒæ™‚ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚')) {
        deleteDoc(doc(db, "meetingRecords", recordId))
          .then(() => {
            showMessage('ğŸ—‘ï¸ è­°äº‹éŒ²ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ', 'success');
          })
          .catch((error) => {
            console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
            showMessage('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'error');
          });
      }
    };

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
    logoutBtn.addEventListener('click', handleLogout);
    showUploadBtn.addEventListener('click', toggleUploadSection);
    cancelUploadBtn.addEventListener('click', toggleUploadSection);
    previewTasksBtn.addEventListener('click', previewTasks);

    // æ¤œç´¢å…¥åŠ›ã§Enterã‚­ãƒ¼å¯¾å¿œ
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        performSearch();
      }
    });

    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    let searchTimeout;
    document.getElementById('searchInput').addEventListener('input', function() {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        if (this.value.length >= 2 || this.value.length === 0) {
          performSearch();
        }
      }, 500);
    });

    // èªè¨¼å®Œäº†å¾Œã®å‡¦ç†
    authReady.then(async (user) => {
      console.log("=== æ”¹ä¿®ç‰ˆè­°äº‹éŒ²ãƒšãƒ¼ã‚¸èªè¨¼å®Œäº† ===");
      console.log("ãƒ¦ãƒ¼ã‚¶ãƒ¼:", user);
      
      await updateAuthDisplay(user);
      
      // è­°äº‹éŒ²ä¸€è¦§ã‚’è¡¨ç¤º
      displayMeetingRecords();
      
    }).catch(error => {
      console.error("=== èªè¨¼å‡¦ç†ã‚¨ãƒ©ãƒ¼ ===");
      console.error(error);
      updateAuthDisplay(null);
      minutesGrid.innerHTML = `
        <div class="error-message">
          <h4>âŒ èªè¨¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h4>
          <p>${error.message}</p>
          <a href="../auth-test.html" style="color: var(--ultla-blue); text-decoration: none; font-weight: 500;">
            ğŸ”‘ ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸ â†’
          </a>
        </div>
      `;
    });

    console.log("=== æ”¹ä¿®ç‰ˆè­°äº‹éŒ²ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº† ===");
  </script>

</body>
</html>